<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GROMACS &mdash; SIRAH Force Field v_1.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=3060a628"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="_static/copybutton.js?v=f281be69"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="NAMD" href="Tutorials%20namd.html" />
    <link rel="prev" title="AMBER" href="Tutorials%20amber.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            SIRAH Force Field
          </a>
              <div class="version">
                v_1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Manual</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="About%20SIRAH.html">About SIRAH</a></li>
<li class="toctree-l1"><a class="reference internal" href="Citation.html">Citations</a></li>
<li class="toctree-l1"><a class="reference internal" href="Further%20reading.html">Further Reading</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="Developers.html">Developers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Tutorials%20amber.html">AMBER</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">GROMACS</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-sirah">Setting up SIRAH</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#required-software">Required Software</a></li>
<li class="toctree-l3"><a class="reference internal" href="#prior-knowledge">Prior knowledge</a></li>
<li class="toctree-l3"><a class="reference internal" href="#download-and-setting-sirah">Download and setting SIRAH</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dna-molecule-in-explicit-solvent">1. DNA molecule in explicit solvent</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#build-cg-representations">1.1. Build CG representations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pdb-to-gromacs-format">1.2. PDB to GROMACS format</a></li>
<li class="toctree-l3"><a class="reference internal" href="#solvate-the-system">1.3. Solvate the system</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-the-simulation">1.4. Run the simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#visualizing-the-simulation">1.5. Visualizing the simulation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#hybrid-solvation">2. Hybrid solvation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id5">2.1. PDB to GROMACS format</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">2.2. Solvate the system</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">2.3. Run the simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">2.4. Visualizing the simulation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#proteins-in-explicit-solvent">3. Proteins in explicit solvent</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id11">3.1. Build CG representations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id13">3.2. PDB to GROMACS format</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id14">3.3. Solvate the system</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id16">3.4. Run the simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id17">3.5. Visualizing the simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#calculate-the-solvent-accessible-surface-sas">3.6. Calculate the solvent accessible surface (SAS)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#closed-circular-dna-in-explicit-solvent">4. Closed circular DNA in explicit solvent</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id22">4.1. Build CG representations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id23">4.2. PDB to GROMACS format</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id24">4.3. Solvate the system</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id26">4.4. Run the simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id27">4.5. Visualizing the simulation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#lipid-bilayers-in-explicit-solvent">5. Lipid bilayers in explicit solvent</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id29">5.1. Build CG representations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id30">5.2. PDB to GROMACS format</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id31">5.3. Solvate the system</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id33">5.4. Run the simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id34">5.5. Visualizing the simulation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#membrane-proteins-in-explicit-solvent">6. Membrane proteins in explicit solvent</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id37">6.1. Build CG representations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#embed-the-protein-in-a-lipid-bilayer">6.2. Embed the protein in a lipid bilayer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#delete-close-contact-lipid-molecules">6.2.1. Delete close contact lipid molecules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id40">6.3. PDB to GROMACS format</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id41">6.4. Solvate the system</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generate-position-restraint-files">6.5. Generate position restraint files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id43">6.6. Run the simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id44">6.7. Visualizing the simulation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Tutorials%20namd.html">NAMD</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tutorials%20sirahtools.html">SIRAH tools</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SIRAH Force Field</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">GROMACS</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Tutorials gromacs.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="gromacs">
<h1>GROMACS<a class="headerlink" href="#gromacs" title="Link to this heading"></a></h1>
<section id="setting-up-sirah">
<span id="download-gromacs"></span><span id="id1"></span><h2>Setting up SIRAH<a class="headerlink" href="#setting-up-sirah" title="Link to this heading"></a></h2>
<section id="required-software">
<h3>Required Software<a class="headerlink" href="#required-software" title="Link to this heading"></a></h3>
<p><strong>GROMACS</strong></p>
<ul class="simple">
<li><p>GROMACS 4.5.5 or later version properly installed in your computer.</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><a class="reference external" href="https://www.gromacs.org/Downloads">Download</a> the lastest version of GROMACS and check its <a class="reference external" href="https://manual.gromacs.org/documentation/current/install-guide/index.html">Installation Guide</a>.</p>
</div>
<p><strong>VMD</strong></p>
<p>The molecular visualization program <a class="reference external" href="https://www.ks.uiuc.edu/Research/vmd/">VMD</a>, version 1.9.3 or later (<a class="reference external" href="https://www.ks.uiuc.edu/Development/Download/download.cgi?PackageName=VMD">freely available download</a>). Check VMD’s <a class="reference external" href="https://www.ks.uiuc.edu/Research/vmd/current/ig/node6.html">Installation guide</a> for more instructions.</p>
</section>
<section id="prior-knowledge">
<h3>Prior knowledge<a class="headerlink" href="#prior-knowledge" title="Link to this heading"></a></h3>
<p>How to perform a standard atomistic molecular dynamics simulations with GROMACS and basic usage of
VMD.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><strong>GROMACS</strong></p>
<p>If you are not familiar with atomistic molecular dynamics simulations, we strongly recommend you to perform the basic usage tutorials of GROMACS: <a class="reference external" href="https://tutorials.gromacs.org/md-intro-tutorial.html">Introduction to Molecular Dynamics</a>, <a class="reference external" href="https://tutorials.gromacs.org/membrane-protein.html">Introduction to Membrane-Protein Simulation</a> and <a class="reference external" href="http://www.mdtutorials.com/gmx/">others</a>. For more details and documentation, check <a class="reference external" href="https://manual.gromacs.org/">GROMACS Manual</a>.</p>
<p><strong>VMD</strong></p>
<p>If you are not familiar with VMD, we strongly recommend you to perform the basic usage tutorial of VMD (<a class="reference external" href="https://www.ks.uiuc.edu/Training/Tutorials/vmd/tutorial-html/index.html">using VMD</a>). For more details and documentation, check <a class="reference external" href="https://www.ks.uiuc.edu/Research/vmd/current/ug/ug.html">VMD User Guide</a> and the official <a class="reference external" href="https://www.ks.uiuc.edu/Research/vmd/current/docs.html#tutorials">VMD documentation</a>.</p>
</div>
</section>
<section id="download-and-setting-sirah">
<h3>Download and setting SIRAH<a class="headerlink" href="#download-and-setting-sirah" title="Link to this heading"></a></h3>
<p>Download <a class="reference external" href="https://github.com/SIRAHFF/documentation/releases/download/GROMACS/sirah_x2.2_20-07.tgz">SIRAH for GROMACS</a> and uncompress it into your working directory.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tar<span class="w"> </span>-xzvf<span class="w"> </span>sirah_x2.2_20-07.tgz
</pre></div>
</div>
<p>In case of using another version of sirah:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tar<span class="w"> </span>-xzvf<span class="w"> </span><span class="sb">``</span>sirah_<span class="o">[</span>version<span class="o">]</span>.tgz<span class="sb">``</span>
</pre></div>
</div>
<p>You will get a folder <code class="docutils literal notranslate"><span class="pre">sirah_[version].ff/</span></code> containing the force field definition, the SIRAH Tools in
<code class="docutils literal notranslate"><span class="pre">sirah_[version].ff/tools/</span></code>, molecular structures to build up systems in <code class="docutils literal notranslate"><span class="pre">sirah_[version].ff/PDB</span></code>, the required material to perform the tutorial in <code class="docutils literal notranslate"><span class="pre">sirah_[version].ff/tutorial/X.X/</span></code>.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Remember to change <strong>X.X</strong> to the number that corresponds to the tutorial you are going to do.</p>
</div>
<p>Make a new folder for this tutorial in your working directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>tutorialX.X<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>tutorialX.X
</pre></div>
</div>
<p>Create the following symbolic links in the folder tutorialX.X:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ln<span class="w"> </span>-s<span class="w"> </span>../sirah_<span class="o">[</span>version<span class="o">]</span>.ff<span class="w"> </span>sirah.ff
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ln<span class="w"> </span>-s<span class="w"> </span>sirah.ff/residuetypes.dat
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ln<span class="w"> </span>-s<span class="w"> </span>sirah.ff/specbond.dat
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Files residuetypes.dat and specbond.dat are essential for the correct definition of molecular
groups and auto-detection of disulfide bonds and cyclic DNA polymers.</p>
</div>
</section>
</section>
<section id="dna-molecule-in-explicit-solvent">
<span id="tutorial-1-g"></span><h2>1. DNA molecule in explicit solvent<a class="headerlink" href="#dna-molecule-in-explicit-solvent" title="Link to this heading"></a></h2>
<p>This tutorial shows how to use the SIRAH force field to perform a coarse grained (CG) simulation of a
double stranded DNA in explicit solvent (called WatFour, WT4). The main references for
this tutorial are: <a class="reference external" href="https://pubs.acs.org/doi/abs/10.1021/ct900653p">Dans et al.</a> (latest parameters are those reported <a class="reference external" href="https://pubs.acs.org/doi/abs/10.1021/ct100379f">here</a>), <a class="reference external" href="https://pubs.acs.org/doi/abs/10.1021/ct100379f">Darré et al.</a>, and <a class="reference external" href="https://academic.oup.com/bioinformatics/article/32/10/1568/1743152">Machado &amp; Pantano</a>.
We strongly advise you to read these articles before starting the tutorial.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Check the <a class="reference internal" href="#download-gromacs"><span class="std std-ref">Setting up SIRAH</span></a> section for download and set up details before starting this tutorial.
Since this is <strong>Tutorial 1</strong>, remember to replace <code class="docutils literal notranslate"><span class="pre">X.X</span></code>, the files corresponding to this tutorial can be found in: <code class="docutils literal notranslate"><span class="pre">sirah.ff/tutorial/1/</span></code></p>
</div>
<section id="build-cg-representations">
<h3>1.1. Build CG representations<a class="headerlink" href="#build-cg-representations" title="Link to this heading"></a></h3>
<p>Map the atomistic structure of a 20-mer DNA to its CG representation:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./sirah.ff/tools/CGCONV/cgconv.pl<span class="w"> </span>-i<span class="w"> </span>sirah.ff/tutorial/1/dna.pdb<span class="w"> </span>-o<span class="w"> </span>dna_cg.pdb
</pre></div>
</div>
<p>The input file <code class="docutils literal notranslate"><span class="pre">-i</span></code> dna.pdb contains all the heavy atoms composing the DNA molecule, while the  output <code class="docutils literal notranslate"><span class="pre">-o</span></code> dna_cg.pdb preserves a few of them.</p>
<p>Please check both PDB structures using VMD:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vmd<span class="w"> </span>-m<span class="w"> </span>./sirah.ff/tutorial/1/dna.pdb<span class="w"> </span>dna_cg.pdb
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This is the basic usage of the script <strong>cgconv.pl</strong>, you can learn other capabilities from its help by typing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./sirah.ff/tools/CGCONV/cgconv.pl<span class="w"> </span>-h
</pre></div>
</div>
</div>
<p>From now on it is just normal GROMACS stuff!</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>In GROMACS versions prior to 5.x, the “gmx” command should not be used.</p>
</div>
</section>
<section id="pdb-to-gromacs-format">
<h3>1.2. PDB to GROMACS format<a class="headerlink" href="#pdb-to-gromacs-format" title="Link to this heading"></a></h3>
<p>Use <code class="docutils literal notranslate"><span class="pre">pdb2gmx</span></code> to convert your PDB file into GROMACS format:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>pdb2gmx<span class="w"> </span>-f<span class="w"> </span>dna_cg.pdb<span class="w"> </span>-o<span class="w"> </span>dna_cg.gro<span class="w"> </span>-merge<span class="w"> </span>all
</pre></div>
</div>
<p>When prompted, choose <em>SIRAH force field</em> and then <em>SIRAH solvent models</em>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Warning messages about long, triangular or square bonds are fine and expected due to the CG topology of some residues.</p>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>However, missing atom messages are errors which probably trace back to the
mapping step. In that case, check your atomistic and mapped structures and do not carry on the
simulation until the problem is solved.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Merging both DNA chains is convenient when planning to apply restraints between them.</p>
</div>
<p>During long simulations of DNA, capping residues may eventually separate. If you want to avoid this
effect, which is called helix fraying, add Watson-Crick (WC) restraints at terminal base pairs. To add
these restraints edit <code class="docutils literal notranslate"><span class="pre">topol.top</span></code> to include the file <code class="docutils literal notranslate"><span class="pre">WC_RST.itp</span></code> at the end of the [ moleculetype ] section:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Topology without WC restraints</p></th>
<th class="head"><p>Topology with WC restraints</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">; Include Position restraint file</div>
<div class="line">#ifdef POSRES</div>
<div class="line">#include “posre.itp”</div>
<div class="line">#endif</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">; Include Position restraint file</div>
<div class="line">#ifdef POSRES</div>
<div class="line">#include “posre.itp”</div>
<div class="line">#endif</div>
<div class="line"><br /></div>
<div class="line">; Watson-Crick restraints</div>
<div class="line">#include “./sirah.ff/tutorial/1/WC_RST.itp”</div>
</div>
</td>
</tr>
</tbody>
</table>
</section>
<section id="solvate-the-system">
<h3>1.3. Solvate the system<a class="headerlink" href="#solvate-the-system" title="Link to this heading"></a></h3>
<p>Define the simulation box of the system</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>editconf<span class="w"> </span>-f<span class="w"> </span>dna_cg.gro<span class="w"> </span>-o<span class="w"> </span>dna_cg_box.gro<span class="w"> </span>-bt<span class="w"> </span>octahedron<span class="w"> </span>-d<span class="w"> </span><span class="m">2</span><span class="w"> </span>-c
</pre></div>
</div>
<p>Add WT4 molecules:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>solvate<span class="w"> </span>-cp<span class="w"> </span>dna_cg_box.gro<span class="w"> </span>-cs<span class="w"> </span>sirah.ff/wt416.gro<span class="w"> </span>-o<span class="w"> </span>dna_cg_sol.gro
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In GROMACS versions prior to 5.x, the command <em>gmx solvate</em> was called <em>genbox</em>.</p>
</div>
<p>Edit the [ molecules ] section in <code class="docutils literal notranslate"><span class="pre">topol.top</span></code> to include the number of added WT4 molecules:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Topology before editing</p></th>
<th class="head"><p>Topology after editing</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">[ molecules ]</div>
<div class="line">; Compound        #mols</div>
<div class="line">DNA_chain_A         1</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">[ molecules ]</div>
<div class="line">; Compound        #mols</div>
<div class="line">DNA_chain_A         1</div>
<div class="line">WT4              3179</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>If you forget to read the number of added WT4 molecules from the output of <em>solvate</em>, then use the following command line to get it</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">grep -c WP1 dna_cg_sol.gro</span>
</pre></div>
</div>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The number of added WT4 molecules, <strong>3179</strong>, may change according to the software version.</p>
</div>
<p>Add CG counterions and 0.15M NaCl:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>sirah.ff/tutorial/1/GPU/em_CGDNA.mdp<span class="w"> </span>-p<span class="w"> </span>topol.top<span class="w"> </span>-c<span class="w"> </span>dna_cg_sol.gro<span class="w"> </span>-o<span class="w"> </span>dna_cg_sol.tpr
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>genion<span class="w"> </span>-s<span class="w"> </span>dna_cg_sol.tpr<span class="w"> </span>-o<span class="w"> </span>dna_cg_ion.gro<span class="w"> </span>-np<span class="w"> </span><span class="m">113</span><span class="w"> </span>-pname<span class="w"> </span>NaW<span class="w"> </span>-nn<span class="w"> </span><span class="m">75</span><span class="w"> </span>-nname<span class="w"> </span>ClW
</pre></div>
</div>
<p>When prompted, choose to substitute <em>WT4</em> molecules by <em>ions</em>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The available electrolyte species in SIRAH force field are: <code class="docutils literal notranslate"><span class="pre">Na⁺</span></code> (NaW), <code class="docutils literal notranslate"><span class="pre">K⁺</span></code> (KW) and <code class="docutils literal notranslate"><span class="pre">Cl⁻</span></code> (ClW) which represent solvated ions in solution. One ion pair (e.g., NaW-ClW) each 34 WT4 molecules results in a salt concentration of ~0.15M (see <a class="reference internal" href="Tutorials%20amber.html#appendix"><span class="std std-ref">Appendix</span></a> for details). Counterions were added according to <a class="reference external" href="https://pubs.acs.org/doi/10.1021/acs.jctc.9b00953">Machado et al.</a>.</p>
</div>
<p>Edit the [ molecules ] section in <code class="docutils literal notranslate"><span class="pre">topol.top</span></code> to include the CG ions and the correct number of WT4.</p>
<p>Before running the simulation it may be a good idea to visualize your molecular system. CG molecules
are not recognized by molecular visualizers and will not display correctly. To fix this problem you may
generate a PSF file of the system using the script <code class="docutils literal notranslate"><span class="pre">g_top2psf.pl</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./sirah.ff/tools/g_top2psf.pl<span class="w"> </span>-i<span class="w"> </span>topol.top<span class="w"> </span>-o<span class="w"> </span>dna_cg_ion.psf
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is the basic usage of the script <code class="docutils literal notranslate"><span class="pre">g_top2psf.pl</span></code>, you can learn other capabilities from its help:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./sirah.ff/tools/g_top2psf.pl<span class="w"> </span>-h
</pre></div>
</div>
</div>
<p>Use VMD to check how the CG system looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vmd</span> <span class="n">dna_cg_ion</span><span class="o">.</span><span class="n">psf</span> <span class="n">dna_cg_ion</span><span class="o">.</span><span class="n">gro</span> <span class="o">-</span><span class="n">e</span> <span class="n">sirah</span><span class="o">.</span><span class="n">ff</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">sirah_vmdtk</span><span class="o">.</span><span class="n">tcl</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>VMD assigns default radius to unknown atom types, the script <code class="docutils literal notranslate"><span class="pre">sirah_vmdtk.tcl</span></code> sets the right ones, according to the CG representation. It also provides a kit of useful selection macros, coloring methods and backmapping utilities.
Use the command <code class="docutils literal notranslate"><span class="pre">sirah_help</span></code> in the Tcl/Tk console of VMD to access the manual pages. To learn about SIRAH Tools’ capabilities, you can also go to the <a class="reference internal" href="Tutorials%20sirahtools.html#sirah-tools"><span class="std std-ref">SIRAH Tools tutorial</span></a>.</p>
</div>
</section>
<section id="run-the-simulation">
<h3>1.4. Run the simulation<a class="headerlink" href="#run-the-simulation" title="Link to this heading"></a></h3>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>By default in this tutorial we will use input files for GROMACS on GPU (<code class="docutils literal notranslate"><span class="pre">sirah.ff/tutorial/1/GPU</span></code>). Example input files for using GROMACS on CPU can be found at: <code class="docutils literal notranslate"><span class="pre">sirah.ff/tutorial/1/CPU</span></code>.</p>
</div>
<p>The folder <code class="docutils literal notranslate"><span class="pre">sirah.ff/tutorial/1/GPU/</span></code> contains typical input files for energy minimization
(<code class="docutils literal notranslate"><span class="pre">em_CGDNA.mdp</span></code>), equilibration (<code class="docutils literal notranslate"><span class="pre">eq_CGDNA.mdp</span></code>) and production (<code class="docutils literal notranslate"><span class="pre">md_CGDNA.mdp</span></code>) runs. Please
check carefully the input flags therein.</p>
<p>Create an index file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;q&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>gmx<span class="w"> </span>make_ndx<span class="w"> </span>-f<span class="w"> </span>dna_cg_ion.gro<span class="w"> </span>-o<span class="w"> </span>dna_cg_ion.ndx
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>WT4 and CG ions (NaW and ClW) are automatically set to the group <em>SIRAH-Solvent</em>.</p>
</div>
<p>Make a new folder for the run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>run<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>run
</pre></div>
</div>
<p><strong>Energy Minimization</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>../sirah.ff/tutorial/1/GPU/em_CGDNA.mdp<span class="w"> </span>-p<span class="w"> </span>../topol.top<span class="w"> </span>-po<span class="w"> </span>em.mdp<span class="w"> </span>-n<span class="w"> </span>../dna_cg_ion.ndx<span class="w"> </span>-c<span class="w"> </span>../dna_cg_ion.gro<span class="w"> </span>-o<span class="w"> </span>dna_cg_em.tpr
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mdrun<span class="w"> </span>-deffnm<span class="w"> </span>dna_cg_em<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>EM.log<span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
<p><strong>Equilibration</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>../sirah.ff/tutorial/1/GPU/eq_CGDNA.mdp<span class="w"> </span>-p<span class="w"> </span>../topol.top<span class="w"> </span>-po<span class="w"> </span>eq.mdp<span class="w"> </span>-n<span class="w"> </span>../dna_cg_ion.ndx<span class="w"> </span>-c<span class="w"> </span>dna_cg_em.gro<span class="w"> </span>-o<span class="w"> </span>dna_cg_eq.tpr
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mdrun<span class="w"> </span>-deffnm<span class="w"> </span>dna_cg_eq<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>EQ.log<span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
<p><strong>Production (100ns)</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>../sirah.ff/tutorial/1/GPU/md_CGDNA.mdp<span class="w"> </span>-p<span class="w"> </span>../topol.top<span class="w"> </span>-po<span class="w"> </span>md.mdp<span class="w"> </span>-n<span class="w"> </span>../dna_cg_ion.ndx<span class="w"> </span>-c<span class="w"> </span>dna_cg_eq.gro<span class="w"> </span>-o<span class="w"> </span>dna_cg_md.tpr
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mdrun<span class="w"> </span>-deffnm<span class="w"> </span>dna_cg_md<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>MD.log<span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>GPU flags have been set for GROMACS 4.6.7; however, different versions may object to certain specifications.</p>
</div>
</section>
<section id="visualizing-the-simulation">
<h3>1.5. Visualizing the simulation<a class="headerlink" href="#visualizing-the-simulation" title="Link to this heading"></a></h3>
<p>That’s it! Now you can analyze the trajectory.</p>
<p>Process the output trajectory at folder <code class="docutils literal notranslate"><span class="pre">run/</span></code> to account for the Periodic Boundary Conditions (PBC):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>trjconv<span class="w"> </span>-s<span class="w"> </span>dna_cg_em.tpr<span class="w"> </span>-f<span class="w"> </span>dna_cg_md.xtc<span class="w"> </span>-o<span class="w"> </span>dna_cg_md_pbc.xtc<span class="w"> </span>-n<span class="w"> </span>../dna_cg_ion.ndx<span class="w"> </span>-ur<span class="w"> </span>compact<span class="w"> </span>-center<span class="w"> </span>-pbc<span class="w"> </span>mol
</pre></div>
</div>
<p>When prompted, choose <em>DNA</em> for centering and <em>System</em> for output.</p>
<p>Now you can check the simulation using VMD:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vmd<span class="w"> </span>../dna_cg_ion.psf<span class="w"> </span>../dna_cg_ion.gro<span class="w"> </span>dna_cg_md_pbc.xtc<span class="w"> </span>-e<span class="w"> </span>../sirah.ff/tools/sirah_vmdtk.tcl
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The file <code class="docutils literal notranslate"><span class="pre">sirah_vmdtk.tcl</span></code> is a Tcl script that is part of SIRAH Tools and contains the macros to properly visualize the coarse-grained structures in VMD. Use the command <code class="docutils literal notranslate"><span class="pre">sirah-help</span></code> in the Tcl/Tk console of VMD to access the manual pages. To learn about SIRAH Tools’ capabilities, you can also go to the <a class="reference internal" href="Tutorials%20sirahtools.html#sirah-tools"><span class="std std-ref">SIRAH Tools tutorial</span></a>.</p>
</div>
</section>
</section>
<section id="hybrid-solvation">
<span id="tutorial-2-g"></span><h2>2. Hybrid solvation<a class="headerlink" href="#hybrid-solvation" title="Link to this heading"></a></h2>
<p>This tutorial shows how to apply the hybrid solvation approach of SIRAH force field to speed up the simulation of an atomistic solute. The example system contains a DNA fiber surrounded by a shell of atomistic waters, which are embedded in coarse-grained (CG) molecules, called WT4, to represent
bulk water. The general procedure is extensible to any other solute. The hybrid solvation methodology is well tested for SPC, SPC/E, TIP3P atomistic water models. The main references for this tutorial are: <a class="reference external" href="https://pubs.acs.org/doi/abs/10.1021/ct100379f">Darré et al.</a>, <a class="reference external" href="https://pubs.rsc.org/en/Content/ArticleLanding/2011/CP/c1cp21248f">Machado et al.</a>, <a class="reference external" href="https://pubs.acs.org/doi/abs/10.1021/jp4079579">Gonzalez et al.</a>, and <a class="reference external" href="https://academic.oup.com/bioinformatics/article/32/10/1568/1743152">Machado &amp; Pantano</a>. We strongly advise you to read these articles before starting the tutorial.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Check the <a class="reference internal" href="#download-gromacs"><span class="std std-ref">Setting up SIRAH</span></a> section for download and set up details before starting this tutorial.
Since this is <strong>Tutorial 2</strong>, remember to replace <code class="docutils literal notranslate"><span class="pre">X.X</span></code>, the files corresponding to this tutorial can be found in: <code class="docutils literal notranslate"><span class="pre">sirah.ff/tutorial/2/</span></code></p>
</div>
<section id="id5">
<h3>2.1. PDB to GROMACS format<a class="headerlink" href="#id5" title="Link to this heading"></a></h3>
<p>Use <code class="docutils literal notranslate"><span class="pre">pdb2gmx</span></code> to convert the PDB file of the solute <code class="docutils literal notranslate"><span class="pre">dna.pdb</span></code> into GROMACS format:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>pdb2gmx<span class="w"> </span>-f<span class="w"> </span>sirah.ff/tutorial/2/dna.pdb<span class="w"> </span>-o<span class="w"> </span>dna.gro
</pre></div>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>In GROMACS versions prior to 5.x, the “gmx” command should not be used.</p>
</div>
<p>When prompted, choose <em>AMBER99SB</em> and then <em>TIP3P</em> as water model.</p>
<p>For GROMACS to recognize SIRAH, edit your topology file <code class="docutils literal notranslate"><span class="pre">topol.top</span></code> adding the following lines <strong>after</strong> the force field definition:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Topology before editing</p></th>
<th class="head"><p>Topology after editing</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">; Include forcefield parameters</div>
<div class="line">#include “amber99sb.ff/forcefield.itp”</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">; Include forcefield parameters</div>
<div class="line">#include “amber99sb.ff/forcefield.itp”</div>
<div class="line">#include “./sirah.ff/hybsol_comb2.itp”</div>
<div class="line">#include “./sirah.ff/solv.itp”</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><code class="docutils literal notranslate"><span class="pre">hybsol_comb2.itp</span></code> is a parameter file, while <code class="docutils literal notranslate"><span class="pre">solv.itp</span></code> links to the topologies of WT4 and SIRAH ions. The choice of the right parameter file depends on the chosen atomistic force field (see <a class="reference internal" href="#tableg"><span class="std std-ref">Table</span></a>). The plug-in works smoothly with the implemented force fields of the GROMACS distribution. When using a customized force field (e.g. for lipids) choose the parameter file according to the combination rule and check that the atom type you are using for the atomistic water match the DEFAULT in the SIRAH parameter file, which is OW. If they don’t match then rename OW accordingly to your definition.</p>
</div>
<p id="tableg">Table. SIRAH parameter file to include in the topology according to the chosen atomistic force field.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head" colspan="2"></th>
<th class="head" colspan="5"><p class="centered">
<strong>Atomistic force field</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Parameter file</p></td>
<td><p>Combination rule</p></td>
<td><p>GMX</p></td>
<td><p>GROMOS</p></td>
<td><p>AMBER</p></td>
<td><p>CHARMM</p></td>
<td><p>OPLS</p></td>
</tr>
<tr class="row-odd"><td><p>hybsol_comb1.itp</p></td>
<td><p class="centered">
<strong>1</strong></p></td>
<td><p>X</p></td>
<td><p>X</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>hybsol_comb2.itp</p></td>
<td><p class="centered">
<strong>2</strong></p></td>
<td></td>
<td></td>
<td><p>X</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>hybsol_comb3.itp</p></td>
<td><p class="centered">
<strong>3</strong></p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>X</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id6">
<h3>2.2. Solvate the system<a class="headerlink" href="#id6" title="Link to this heading"></a></h3>
<p>Define the simulation box of the system:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>editconf<span class="w"> </span>-f<span class="w"> </span>dna.gro<span class="w"> </span>-o<span class="w"> </span>dna_box.gro<span class="w"> </span>-bt<span class="w"> </span>octahedron<span class="w"> </span>-d<span class="w"> </span><span class="m">2</span><span class="w"> </span>-c
</pre></div>
</div>
<p>Then add an atomistic water shell:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>solvate<span class="w"> </span>-cp<span class="w"> </span>dna_box.gro<span class="w"> </span>-cs<span class="w"> </span>spc216.gro<span class="w"> </span>-o<span class="w"> </span>dna_shell.gro<span class="w"> </span>-shell<span class="w"> </span><span class="m">1</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In GROMACS versions prior to 5.x, the command <em>gmx solvate</em> was called <em>genbox</em>.</p>
</div>
<p>Finally add the CG solvent:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>solvate<span class="w"> </span>-cp<span class="w"> </span>dna_shell.gro<span class="w"> </span>-cs<span class="w"> </span>./sirah.ff/wt4tip3p.gro<span class="w"> </span>-o<span class="w"> </span>dna_sol.gro
</pre></div>
</div>
<p>Edit the [ molecules ] section in <code class="docutils literal notranslate"><span class="pre">topol.top</span></code> to include the number of SOL and WT4 molecules:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Topology before editing</p></th>
<th class="head"><p>Topology after editing</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">[ molecules ]</div>
<div class="line">; Compound        #mols</div>
<div class="line">DNA_chain_A         1</div>
<div class="line">DNA_chain_B         1</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">[ molecules ]</div>
<div class="line">; Compound        #mols</div>
<div class="line">DNA_chain_A         1</div>
<div class="line">DNA_chain_B         1</div>
<div class="line">SOL              3580</div>
<div class="line">WT4              2659</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>If you forget to look at the result of <em>solvate</em> to see how many SOL and WT4 molecules were added, you can use the following command line to get these numbers:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">grep -c OW dna_sol.gro; grep -c WP1 dna_sol.gro</span>
</pre></div>
</div>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The number of added SOL (<strong>3580</strong>) and WT4 (<strong>2659</strong>) molecules,  may change according to the software version.</p>
</div>
<p>Add CG counterions:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>sirah.ff/tutorial/2/GPU/em_HYBSOL.mdp<span class="w"> </span>-p<span class="w"> </span>topol.top<span class="w"> </span>-c<span class="w"> </span>dna_sol.gro<span class="w"> </span>-o<span class="w"> </span>dna_sol.tpr
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>genion<span class="w"> </span>-s<span class="w"> </span>dna_sol.tpr<span class="w"> </span>-o<span class="w"> </span>dna_ion.gro<span class="w"> </span>-np<span class="w"> </span><span class="m">38</span><span class="w"> </span>-pname<span class="w"> </span>NaW
</pre></div>
</div>
<p>When prompted, choose to substitute <em>WT4</em> molecules by <em>NaW</em> ions.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The available electrolyte species in SIRAH force field are: <code class="docutils literal notranslate"><span class="pre">Na⁺</span></code> (NaW), <code class="docutils literal notranslate"><span class="pre">K⁺</span></code> (KW) and <code class="docutils literal notranslate"><span class="pre">Cl⁻</span></code> (ClW) which represent solvated ions in solution. One ion pair (e.g., NaW-ClW) each 34 WT4 molecules results in a salt concentration of ~0.15M (see <a class="reference internal" href="Tutorials%20amber.html#appendix"><span class="std std-ref">Appendix</span></a> for details).
Be aware that SIRAH ions remain within the CG phase. So, if the presence of atomistic electrolytes in close contact with the solute is important to describe the physics of the system you will have to add them.</p>
</div>
<p>Edit the [ molecules ] section in <code class="docutils literal notranslate"><span class="pre">topol.top</span></code> to include the 38 NaW ions and the correct number of WT4 molecules.</p>
<p>Before running the simulation it may be a good idea to visualize your molecular system. CG molecules
are not recognized by molecular visualizers and will not display correctly. To fix this problem you may
generate a PSF file of the system using the script <code class="docutils literal notranslate"><span class="pre">g_top2psf.pl</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./sirah.ff/tools/g_top2psf.pl<span class="w"> </span>-i<span class="w"> </span>topol.top<span class="w"> </span>-o<span class="w"> </span>dna_ion.psf
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is the basic usage of the script <code class="docutils literal notranslate"><span class="pre">g_top2psf.pl</span></code>, you can learn other capabilities from its help:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./sirah.ff/tools/g_top2psf.pl<span class="w"> </span>-h
</pre></div>
</div>
</div>
<p>Use VMD to check how the hybrid system looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vmd</span> <span class="n">dna_ion</span><span class="o">.</span><span class="n">psf</span> <span class="n">dna_ion</span><span class="o">.</span><span class="n">gro</span> <span class="o">-</span><span class="n">e</span> <span class="n">sirah</span><span class="o">.</span><span class="n">ff</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">sirah_vmdtk</span><span class="o">.</span><span class="n">tcl</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>VMD assigns default radius to unknown atom types, the script <code class="docutils literal notranslate"><span class="pre">sirah_vmdtk.tcl</span></code> sets the right ones, according to the CG representation. It also provides a kit of useful selection macros, coloring methods and backmapping utilities.
Use the command <code class="docutils literal notranslate"><span class="pre">sirah_help</span></code> in the Tcl/Tk console of VMD to access the manual pages. To learn about SIRAH Tools’ capabilities, you can also go to the <a class="reference internal" href="Tutorials%20sirahtools.html#sirah-tools"><span class="std std-ref">SIRAH Tools tutorial</span></a>.</p>
</div>
</section>
<section id="id7">
<h3>2.3. Run the simulation<a class="headerlink" href="#id7" title="Link to this heading"></a></h3>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>By default in this tutorial we will use input files for GROMACS on GPU (<code class="docutils literal notranslate"><span class="pre">sirah.ff/tutorial/2/GPU</span></code>). Example input files for using GROMACS on CPU can be found at: <code class="docutils literal notranslate"><span class="pre">sirah.ff/tutorial/2/CPU</span></code>.</p>
</div>
<p>The folder <code class="docutils literal notranslate"><span class="pre">sirah.ff/tutorial/2/GPU/</span></code> contains typical input files for energy minimization
(<code class="docutils literal notranslate"><span class="pre">em_HYBSOL.mdp</span></code>), equilibration (<code class="docutils literal notranslate"><span class="pre">eq_HYBSOL.mdp</span></code>) and production (<code class="docutils literal notranslate"><span class="pre">md_HYBSOL.mdp</span></code>) runs. Please
check carefully the input flags therein.</p>
<p>Create an index files adding a group for WT4 and NaW:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;r WT4 | r NaW\nq\n&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>make_ndx<span class="w"> </span>-f<span class="w"> </span>dna_ion.gro<span class="w"> </span>-o<span class="w"> </span>dna_ion.ndx
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>WT4 and CG ions (NaW and ClW) are automatically set to the group <em>SIRAH-Solvent</em>.</p>
</div>
<p>Make a new folder for the run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>run<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>run
</pre></div>
</div>
<p><strong>Energy Minimization</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>../sirah.ff/tutorial/2/GPU/em_HYBSOL.mdp<span class="w"> </span>-p<span class="w"> </span>../topol.top<span class="w"> </span>-po<span class="w"> </span>em.mdp<span class="w"> </span>-n<span class="w"> </span>../dna_ion.ndx<span class="w"> </span>-c<span class="w"> </span>../dna_ion.gro<span class="w"> </span>-o<span class="w"> </span>dna_em.tpr
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mdrun<span class="w"> </span>-deffnm<span class="w"> </span>dna_em<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>EM.log<span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
<p><strong>Equilibration</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>../sirah.ff/tutorial/2/GPU/eq_HYBSOL.mdp<span class="w"> </span>-p<span class="w"> </span>../topol.top<span class="w"> </span>-po<span class="w"> </span>eq.mdp<span class="w"> </span>-n<span class="w"> </span>../dna_ion.ndx<span class="w"> </span>-c<span class="w"> </span>dna_em.gro<span class="w"> </span>-o<span class="w"> </span>dna_eq.tpr
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mdrun<span class="w"> </span>-deffnm<span class="w"> </span>dna_eq<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>EQ.log<span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
<p><strong>Production (100ns)</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>../sirah.ff/tutorial/2/GPU/md_HYBSOL.mdp<span class="w"> </span>-p<span class="w"> </span>../topol.top<span class="w"> </span>-po<span class="w"> </span>md.mdp<span class="w"> </span>-n<span class="w"> </span>../dna_ion.ndx<span class="w"> </span>-c<span class="w"> </span>dna_eq.gro<span class="w"> </span>-o<span class="w"> </span>dna_md.tpr
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mdrun<span class="w"> </span>-deffnm<span class="w"> </span>dna_md<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>MD.log<span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>GPU flags have been set for GROMACS 4.6.7; however, different versions may object to certain specifications.</p>
</div>
</section>
<section id="id8">
<h3>2.4. Visualizing the simulation<a class="headerlink" href="#id8" title="Link to this heading"></a></h3>
<p>That’s it! Now you can analyze the trajectory.</p>
<p>Process the output trajectory at folder <code class="docutils literal notranslate"><span class="pre">run/</span></code> to account for the Periodic Boundary Conditions (PBC):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>trjconv<span class="w"> </span>-s<span class="w"> </span>dna_em.tpr<span class="w"> </span>-f<span class="w"> </span>dna_md.xtc<span class="w"> </span>-o<span class="w"> </span>dna_md_pbc.xtc<span class="w"> </span>-n<span class="w"> </span>../dna_ion.ndx<span class="w"> </span>-ur<span class="w"> </span>compact<span class="w"> </span>-center<span class="w"> </span>-pbc<span class="w"> </span>mol
</pre></div>
</div>
<p>When prompted, choose <em>DNA</em> for centering and <em>System</em> for output.</p>
<p>Now you can check the simulation using VMD:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vmd<span class="w"> </span>../dna_ion.psf<span class="w"> </span>../dna_ion.gro<span class="w"> </span>dna_md_pbc.xtc<span class="w"> </span>-e<span class="w"> </span>../sirah.ff/tools/sirah_vmdtk.tcl
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The file <code class="docutils literal notranslate"><span class="pre">sirah_vmdtk.tcl</span></code> is a Tcl script that is part of SIRAH Tools and contains the macros to properly visualize the coarse-grained structures in VMD. Use the command <code class="docutils literal notranslate"><span class="pre">sirah-help</span></code> in the Tcl/Tk console of VMD to access the manual pages. To learn about SIRAH Tools’ capabilities, you can also go to the <a class="reference internal" href="Tutorials%20sirahtools.html#sirah-tools"><span class="std std-ref">SIRAH Tools tutorial</span></a>.</p>
</div>
</section>
</section>
<section id="proteins-in-explicit-solvent">
<span id="tutorial-3-g"></span><h2>3. Proteins in explicit solvent<a class="headerlink" href="#proteins-in-explicit-solvent" title="Link to this heading"></a></h2>
<p>This tutorial shows how to use the SIRAH force field to perform a coarse grained (CG) simulation of a
protein in explicit solvent (called WatFour, WT4). The main references for this tutorial are:  <a class="reference external" href="https://pubs.acs.org/doi/abs/10.1021/ct900653p">Dans et al.</a>, <a class="reference external" href="https://pubs.acs.org/doi/abs/10.1021/ct100379f">Darré et al.</a>, <a class="reference external" href="https://doi.org/10.1021/acs.jctc.9b00006">Machado et al.</a>,  and <a class="reference external" href="https://academic.oup.com/bioinformatics/article/32/10/1568/1743152">Machado &amp; Pantano</a>. We strongly advise you to read these articles before starting the tutorial.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Check the <a class="reference internal" href="#download-gromacs"><span class="std std-ref">Setting up SIRAH</span></a> section for download and set up details before starting this tutorial.
Since this is <strong>Tutorial 3</strong>, remember to replace <code class="docutils literal notranslate"><span class="pre">X.X</span></code>, the files corresponding to this tutorial can be found in: <code class="docutils literal notranslate"><span class="pre">sirah.ff/tutorial/3/</span></code></p>
</div>
<section id="id11">
<h3>3.1. Build CG representations<a class="headerlink" href="#id11" title="Link to this heading"></a></h3>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The mapping to CG requires the correct protonation state of each residue at a given pH. We recommend using the <a class="reference external" href="https://www.charmm-gui.org/">CHARMM-GUI server</a> and use the <strong>PDB Reader &amp; Manipulator</strong> to prepare your system. An account is required to access any of the CHARMM-GUI Input Generator modules, and it can take up to 24 hours to obtain one.</p>
<p>Other option is the <a class="reference external" href="https://server.poissonboltzmann.org/pdb2pqr">PDB2PQR server</a> and choosing the output naming scheme of AMBER for best compatibility. This server was utilized to generate the <em>PQR</em> file featured in this tutorial. Be aware that modified residues lacking parameters such as: MSE (seleno MET), TPO (phosphorylated THY), SEP (phosphorylated SER) or others are deleted from the PQR file by the server. In that case, mutate the residues to their unmodified form before submitting the structure to the server.</p>
</div>
<p>Map the protonated atomistic structure of protein <a class="reference external" href="https://www.rcsb.org/structure/1CRN">1CRN</a> to its CG representation:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./sirah.ff/tools/CGCONV/cgconv.pl<span class="w"> </span>-i<span class="w"> </span>sirah.ff/tutorial/3/1CRN.pqr<span class="w"> </span>-o<span class="w"> </span>1CRN_cg.pdb
</pre></div>
</div>
<p>The input file <code class="docutils literal notranslate"><span class="pre">-i</span></code> 1CRN.pqr contains the atomistic representation of <a class="reference external" href="https://www.rcsb.org/structure/1CRN">1CRN</a> structure at pH <strong>7.0</strong>, while the output <code class="docutils literal notranslate"><span class="pre">-o</span></code> 1CRN_cg.pdb is its SIRAH CG representation.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This is the basic usage of the script <strong>cgconv.pl</strong>, you can learn other capabilities from its help by typing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./sirah.ff/tools/CGCONV/cgconv.pl<span class="w"> </span>-h
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Pay attention to residue names when mapping structures from other atomistic force fields or experimental structures.</strong> Although we provide compatibility for naming schemes in PDB, GMX, GROMOS, CHARMM and OPLS, there might always be some ambiguity in the residue naming, specially regarding protonation states, that may lead to a wrong mapping. For example, SIRAH Tools always maps the residue name “HIS” to a Histidine protonated at the epsilon nitrogen (<span class="math notranslate nohighlight">\(N_{\epsilon}\)</span>) regardless the actual proton placement. Similarly, protonated Glutamic and Aspartic acid residues must be named “GLH” and “ASH”, otherwise they will be treated as negative charged residues. In addition, protonated and disulfide bonded Cysteines must be named “CYS” and “CYX” respectively. These kind of situations need to be carefully checked by the users. In all cases the residues preserve their identity when mapping and back-mapping the structures. Hence, the total charge of the protein should be the same at atomistic and SIRAH levels. You can check the following mapping file to be sure of the compatibility: <code class="docutils literal notranslate"><span class="pre">sirah.ff/tools/CGCONV/maps/sirah_prot.map</span></code>.</p>
</div>
<p>Please check both PDB and PQR structures using VMD:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vmd<span class="w"> </span>-m<span class="w"> </span>sirah.ff/tutorial/3/1CRN.pqr<span class="w"> </span>1CRN_cg.pdb
</pre></div>
</div>
<p>From now on it is just normal GROMACS stuff!</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>In GROMACS versions prior to 5.x, the “gmx” command should not be used.</p>
</div>
</section>
<section id="id13">
<h3>3.2. PDB to GROMACS format<a class="headerlink" href="#id13" title="Link to this heading"></a></h3>
<p>Use <code class="docutils literal notranslate"><span class="pre">pdb2gmx</span></code> to convert your PDB file into GROMACS format:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>pdb2gmx<span class="w"> </span>-f<span class="w"> </span>1CRN_cg.pdb<span class="w"> </span>-o<span class="w"> </span>1CRN_cg.gro
</pre></div>
</div>
<p>When prompted, choose <em>SIRAH force field</em> and then <em>SIRAH solvent models</em>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default charged terminal are used, but it is possible to set them neutral with option <code class="docutils literal notranslate"><span class="pre">-ter</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Warning messages about long, triangular or square bonds are fine and expected due to the CG topology of some residues.</p>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>However, missing atom messages are errors which probably trace back to the
mapping step. In that case, check your atomistic and mapped structures and do not carry on the
simulation until the problem is solved.</p>
</div>
</section>
<section id="id14">
<h3>3.3. Solvate the system<a class="headerlink" href="#id14" title="Link to this heading"></a></h3>
<p>Define the simulation box of the system</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>editconf<span class="w"> </span>-f<span class="w"> </span>1CRN_cg.gro<span class="w"> </span>-o<span class="w"> </span>1CRN_cg_box.gro<span class="w"> </span>-bt<span class="w"> </span>octahedron<span class="w"> </span>-d<span class="w"> </span><span class="m">2</span>.0<span class="w"> </span>-c
</pre></div>
</div>
<p>Add WT4 molecules:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>solvate<span class="w"> </span>-cp<span class="w"> </span>1CRN_cg_box.gro<span class="w"> </span>-cs<span class="w"> </span>sirah.ff/wt416.gro<span class="w"> </span>-o<span class="w"> </span>1CRN_cg_sol1.gro
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In GROMACS versions prior to 5.x, the command <em>gmx solvate</em> was called <em>genbox</em>.</p>
</div>
<p>Edit the [ molecules ] section in <code class="docutils literal notranslate"><span class="pre">topol.top</span></code> to include the number of added WT4 molecules:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Topology before editing</p></th>
<th class="head"><p>Topology after editing</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">[ molecules ]</div>
<div class="line">; Compound        #mols</div>
<div class="line">Protein_chain_A     1</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">[ molecules ]</div>
<div class="line">; Compound        #mols</div>
<div class="line">Protein_chain_A     1</div>
<div class="line">WT4               756</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>If you forget to read the number of added WT4 molecules from the output of <em>solvate</em>, then use the following command line to get it</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">grep -c WP1 1CRN_cg_sol1.gro</span>
</pre></div>
</div>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The number of added WT4 molecules, <strong>756</strong>, may change according to the software version.</p>
</div>
<p>Remove WT4 molecules within 0.3 nm of protein:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span>q<span class="w"> </span><span class="p">|</span><span class="w"> </span>gmx<span class="w"> </span>make_ndx<span class="w"> </span>-f<span class="w"> </span>1CRN_cg_sol1.gro<span class="w"> </span>-o<span class="w"> </span>1CRN_cg_sol1.ndx
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>sirah.ff/tutorial/3/GPU/em1_CGPROT.mdp<span class="w"> </span>-p<span class="w"> </span>topol.top<span class="w"> </span>-po<span class="w"> </span>delete1.mdp<span class="w"> </span>-c<span class="w"> </span>1CRN_cg_sol1.gro<span class="w"> </span>-o<span class="w"> </span>1CRN_cg_sol1.tpr
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span><span class="k">select</span><span class="w"> </span>-f<span class="w"> </span>1CRN_cg_sol1.gro<span class="w"> </span>-s<span class="w"> </span>1CRN_cg_sol1.tpr<span class="w"> </span>-n<span class="w"> </span>1CRN_cg_sol1.ndx<span class="w"> </span>-on<span class="w"> </span>rm_close_wt4.ndx<span class="w"> </span>-select<span class="w"> </span><span class="s1">&#39;not (same residue as (resname WT4 and within 0.3 of group Protein))&#39;</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>editconf<span class="w"> </span>-f<span class="w"> </span>1CRN_cg_sol1.gro<span class="w"> </span>-o<span class="w"> </span>1CRN_cg_sol2.gro<span class="w"> </span>-n<span class="w"> </span>rm_close_wt4.ndx
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In GROMACS versions prior to 5.x, the command <em>gmx select</em> was called <em>g_select</em>.</p>
</div>
<p>Edit the [ molecules ] section in <code class="docutils literal notranslate"><span class="pre">topol.top</span></code> to include the correct number of WT4 molecules:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>grep<span class="w"> </span>-c<span class="w"> </span>WP1<span class="w"> </span>1CRN_cg_sol2.gro
</pre></div>
</div>
<p>Add CG counterions and 0.15M NaCl:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>sirah.ff/tutorial/3/GPU/em1_CGPROT.mdp<span class="w"> </span>-p<span class="w"> </span>topol.top<span class="w"> </span>-po<span class="w"> </span>delete2.mdp<span class="w"> </span>-c<span class="w"> </span>1CRN_cg_sol2.gro<span class="w"> </span>-o<span class="w"> </span>1CRN_cg_sol2.tpr
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>genion<span class="w"> </span>-s<span class="w"> </span>1CRN_cg_sol2.tpr<span class="w"> </span>-o<span class="w"> </span>1CRN_cg_ion.gro<span class="w"> </span>-np<span class="w"> </span><span class="m">22</span><span class="w"> </span>-pname<span class="w"> </span>NaW<span class="w"> </span>-nn<span class="w"> </span><span class="m">22</span><span class="w"> </span>-nname<span class="w"> </span>ClW
</pre></div>
</div>
<p>When prompted, choose to substitute <em>WT4</em> molecules by <em>ions</em>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The available electrolyte species in SIRAH force field are: <code class="docutils literal notranslate"><span class="pre">Na⁺</span></code> (NaW), <code class="docutils literal notranslate"><span class="pre">K⁺</span></code> (KW) and <code class="docutils literal notranslate"><span class="pre">Cl⁻</span></code> (ClW) which represent solvated ions in solution. One ion pair (e.g., NaW-ClW) each 34 WT4 molecules results in a salt concentration of ~0.15M (see <a class="reference internal" href="Tutorials%20amber.html#appendix"><span class="std std-ref">Appendix</span></a> for details). Counterions were added according to <a class="reference external" href="https://pubs.acs.org/doi/10.1021/acs.jctc.9b00953">Machado et al.</a>.</p>
</div>
<p>Edit the [ molecules ] section in <code class="docutils literal notranslate"><span class="pre">topol.top</span></code> to include the CG ions and the correct number of WT4.</p>
<p>Before running the simulation it may be a good idea to visualize your molecular system. CG molecules
are not recognized by molecular visualizers and will not display correctly. To fix this problem you may
generate a PSF file of the system using the script <code class="docutils literal notranslate"><span class="pre">g_top2psf.pl</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./sirah.ff/tools/g_top2psf.pl<span class="w"> </span>-i<span class="w"> </span>topol.top<span class="w"> </span>-o<span class="w"> </span>1CRN_cg_ion.psf
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is the basic usage of the script <code class="docutils literal notranslate"><span class="pre">g_top2psf.pl</span></code>, you can learn other capabilities from its help:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./sirah.ff/tools/g_top2psf.pl<span class="w"> </span>-h
</pre></div>
</div>
</div>
<p>Use VMD to check how the CG system looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vmd</span> <span class="mi">1</span><span class="n">CRN_cg_ion</span><span class="o">.</span><span class="n">psf</span> <span class="mi">1</span><span class="n">CRN_cg_ion</span><span class="o">.</span><span class="n">gro</span> <span class="o">-</span><span class="n">e</span> <span class="n">sirah</span><span class="o">.</span><span class="n">ff</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">sirah_vmdtk</span><span class="o">.</span><span class="n">tcl</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>VMD assigns default radius to unknown atom types, the script <code class="docutils literal notranslate"><span class="pre">sirah_vmdtk.tcl</span></code> sets the right ones, according to the CG representation. It also provides a kit of useful selection macros, coloring methods and backmapping utilities.
Use the command <code class="docutils literal notranslate"><span class="pre">sirah_help</span></code> in the Tcl/Tk console of VMD to access the manual pages. To learn about SIRAH Tools’ capabilities, you can also go to the <a class="reference internal" href="Tutorials%20sirahtools.html#sirah-tools"><span class="std std-ref">SIRAH Tools tutorial</span></a>.</p>
</div>
<p>Create an index file including a group for the backbone GN and GO beads:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;a GN GO\n\nq&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>gmx<span class="w"> </span>make_ndx<span class="w"> </span>-f<span class="w"> </span>1CRN_cg_ion.gro<span class="w"> </span>-o<span class="w"> </span>1CRN_cg_ion.ndx
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>WT4 and CG ions (NaW, ClW) are automatically set to the group <em>SIRAH-Solvent</em>.</p>
</div>
<p>Generate restraint files for the backbone <em>GN</em> and <em>GO</em> beads:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>genrestr<span class="w"> </span>-f<span class="w"> </span>1CRN_cg.gro<span class="w"> </span>-n<span class="w"> </span>1CRN_cg_ion.ndx<span class="w"> </span>-o<span class="w"> </span>bkbres.itp
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>genrestr<span class="w"> </span>-f<span class="w"> </span>1CRN_cg.gro<span class="w"> </span>-n<span class="w"> </span>1CRN_cg_ion.ndx<span class="w"> </span>-o<span class="w"> </span>bkbres_soft.itp<span class="w"> </span>-fc<span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">100</span>
</pre></div>
</div>
<p>When prompted, choose the group <em>GN_GO</em></p>
<p>Add restraints to <code class="docutils literal notranslate"><span class="pre">topol.top</span></code></p>
<table class="docutils align-center">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Topology before editing</p></th>
<th class="head"><p>Topology after editing</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">; Include Position restraint file</div>
<div class="line">#ifdef POSRES</div>
<div class="line">#include “posre.itp”</div>
<div class="line">#endif</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">; Include Position restraint file</div>
<div class="line">#ifdef POSRES</div>
<div class="line">#include “posre.itp”</div>
<div class="line">#endif</div>
</div>
<div class="line-block">
<div class="line">; Backbone restraints</div>
<div class="line">#ifdef GN_GO</div>
<div class="line">#include “bkbres.itp”</div>
<div class="line">#endif</div>
</div>
<div class="line-block">
<div class="line">; Backbone soft restrains</div>
<div class="line">#ifdef GN_GO_SOFT</div>
<div class="line">#include “bkbres_soft.itp”</div>
<div class="line">#endif</div>
</div>
</td>
</tr>
</tbody>
</table>
</section>
<section id="id16">
<h3>3.4. Run the simulation<a class="headerlink" href="#id16" title="Link to this heading"></a></h3>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>By default in this tutorial we will use input files for GROMACS on GPU (<code class="docutils literal notranslate"><span class="pre">sirah.ff/tutorial/3/GPU</span></code>). Example input files for using GROMACS on CPU can be found at: <code class="docutils literal notranslate"><span class="pre">sirah.ff/tutorial/3/CPU</span></code>.</p>
</div>
<p>The folder <code class="docutils literal notranslate"><span class="pre">sirah.ff/tutorial/3/GPU/</span></code> contains typical input files for energy minimization
(<code class="docutils literal notranslate"><span class="pre">em1_CGPROT.mdp</span></code>, <code class="docutils literal notranslate"><span class="pre">em2_CGPROT.mdp</span></code>), equilibration (<code class="docutils literal notranslate"><span class="pre">eq1_CGPROT.mdp</span></code>, <code class="docutils literal notranslate"><span class="pre">eq2_CGPROT.mdp</span></code>)
and production (<code class="docutils literal notranslate"><span class="pre">md_CGPROT.mdp</span></code>) runs. Please check carefully the input flags therein.</p>
<p>Make a new folder for the run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>-p<span class="w"> </span>run<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>run
</pre></div>
</div>
<p><strong>Energy Minimization of side chains by restraining the backbone</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>../sirah.ff/tutorial/3/GPU/em1_CGPROT.mdp<span class="w"> </span>-p<span class="w"> </span>../topol.top<span class="w"> </span>-po<span class="w"> </span>em1.mdp<span class="w"> </span>-n<span class="w"> </span>../1CRN_cg_ion.ndx<span class="w"> </span>-c<span class="w"> </span>../1CRN_cg_ion.gro<span class="w"> </span>-r<span class="w"> </span>../1CRN_cg_ion.gro<span class="w"> </span>-o<span class="w"> </span>1CRN_cg_em1.tpr
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>mdrun<span class="w"> </span>-deffnm<span class="w"> </span>1CRN_cg_em1<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>EM1.log<span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
<p><strong>Energy Minimization of whole system</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>../sirah.ff/tutorial/3/GPU/em2_CGPROT.mdp<span class="w"> </span>-p<span class="w"> </span>../topol.top<span class="w"> </span>-po<span class="w"> </span>em2.mdp<span class="w"> </span>-n<span class="w"> </span>../1CRN_cg_ion.ndx<span class="w"> </span>-c<span class="w"> </span>1CRN_cg_em1.gro<span class="w"> </span>-o<span class="w"> </span>1CRN_cg_em2.tpr
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>mdrun<span class="w"> </span>-deffnm<span class="w"> </span>1CRN_cg_em2<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>EM2.log<span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
<p><strong>Solvent equilibration</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>../sirah.ff/tutorial/3/GPU/eq1_CGPROT.mdp<span class="w"> </span>-p<span class="w"> </span>../topol.top<span class="w"> </span>-po<span class="w"> </span>eq1.mdp<span class="w"> </span>-n<span class="w"> </span>./1CRN_cg_ion.ndx<span class="w"> </span>-c<span class="w"> </span>1CRN_cg_em2.gro<span class="w"> </span>-r<span class="w"> </span>1CRN_cg_em2.gro<span class="w"> </span>-o<span class="w"> </span>1CRN_cg_eq1.tpr
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>mdrun<span class="w"> </span>-deffnm<span class="w"> </span>1CRN_cg_eq1<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>EQ1.log<span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
<p><strong>Soft equilibration to improve side chain solvation</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>../sirah.ff/tutorial/3/GPU/eq2_CGPROT.mdp<span class="w"> </span>-p<span class="w"> </span>../topol.top<span class="w"> </span>-po<span class="w"> </span>eq2.mdp<span class="w"> </span>-n<span class="w"> </span>../1CRN_cg_ion.ndx<span class="w"> </span>-c<span class="w"> </span>1CRN_cg_eq1.gro<span class="w"> </span>-r<span class="w"> </span>1CRN_cg_eq1.gro<span class="w"> </span>-o<span class="w"> </span>1CRN_cg_eq2.tpr
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>mdrun<span class="w"> </span>-deffnm<span class="w"> </span>1CRN_cg_eq2<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>EQ2.log<span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
<p><strong>Production (1000 ns)</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>../sirah.ff/tutorial/3/GPU/md_CGPROT.mdp<span class="w"> </span>-p<span class="w"> </span>../topol.top<span class="w"> </span>-po<span class="w"> </span>md.mdp<span class="w"> </span>-n<span class="w"> </span>../1CRN_cg_ion.ndx<span class="w"> </span>-c<span class="w"> </span>1CRN_cg_eq2.gro<span class="w"> </span>-o<span class="w"> </span>1CRN_cg_md.tpr
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>mdrun<span class="w"> </span>-deffnm<span class="w"> </span>1CRN_cg_md<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>MD.log<span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>GPU flags have been set for GROMACS 4.6.7; however, different versions may object to certain specifications.</p>
</div>
</section>
<section id="id17">
<h3>3.5. Visualizing the simulation<a class="headerlink" href="#id17" title="Link to this heading"></a></h3>
<p>That’s it! Now you can analyze the trajectory.</p>
<p>Process the output trajectory at folder <code class="docutils literal notranslate"><span class="pre">run/</span></code> to account for the Periodic Boundary Conditions (PBC):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>trjconv<span class="w"> </span>-s<span class="w"> </span>1CRN_cg_em1.tpr<span class="w"> </span>-f<span class="w"> </span>1CRN_cg_md.xtc<span class="w"> </span>-o<span class="w"> </span>1CRN_cg_md_pbc.xtc<span class="w"> </span>-n<span class="w"> </span>../1CRN_cg_ion.ndx<span class="w"> </span>-ur<span class="w"> </span>compact<span class="w"> </span>-center<span class="w"> </span>-pbc<span class="w"> </span>mol
</pre></div>
</div>
<p>When prompted, choose <em>Protein</em> for centering and <em>System</em> for output.</p>
<p>Now you can check the simulation using VMD:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vmd<span class="w"> </span>../1CRN_cg_ion.psf<span class="w"> </span>../1CRN_cg_ion.gro<span class="w"> </span>1CRN_cg_md_pbc.xtc<span class="w"> </span>-e<span class="w"> </span>../sirah.ff/tools/sirah_vmdtk.tcl
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The file <code class="docutils literal notranslate"><span class="pre">sirah_vmdtk.tcl</span></code> is a Tcl script that is part of SIRAH Tools and contains the macros to properly visualize the coarse-grained structures in VMD. Use the command <code class="docutils literal notranslate"><span class="pre">sirah-help</span></code> in the Tcl/Tk console of VMD to access the manual pages. To learn about SIRAH Tools’ capabilities, you can also go to the <a class="reference internal" href="Tutorials%20sirahtools.html#sirah-tools"><span class="std std-ref">SIRAH Tools tutorial</span></a>.</p>
</div>
</section>
<section id="calculate-the-solvent-accessible-surface-sas">
<h3>3.6. Calculate the solvent accessible surface (SAS)<a class="headerlink" href="#calculate-the-solvent-accessible-surface-sas" title="Link to this heading"></a></h3>
<p>Create the following symbolic link in the folder <code class="docutils literal notranslate"><span class="pre">run/</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ln<span class="w"> </span>-s<span class="w"> </span>../sirah.ff/vdwradii.dat
</pre></div>
</div>
<p>Calculate the SAS of the protein along the trajectory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>g_sas<span class="w"> </span>-s<span class="w"> </span>1CRN_cg_md.tpr<span class="w"> </span>-f<span class="w"> </span>1CRN_cg_md_pbc.xtc<span class="w"> </span>-n<span class="w"> </span>../1CRN_cg_ion.ndx<span class="w"> </span>-qmax<span class="w"> </span><span class="m">0</span><span class="w"> </span>-probe<span class="w"> </span><span class="m">0</span>.21<span class="w"> </span>-o<span class="w"> </span>area.xvg
</pre></div>
</div>
<p>When prompted, choose <em>Protein</em> as both the group for calculation and the output.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The solvent probe radius corresponds to a WT4 bead while a charge of 0e refers to any
hydrophobic bead. The file <code class="docutils literal notranslate"><span class="pre">vdwradii.dat</span></code> must be placed at the same folder where <em>gmx sasa</em> is executed to assure that the correct van der Waals radii of SIRAH beads are used in the calculation.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><em>g_sas</em> is deprecated, the tool no longer automatically divides the surface into hydrophobic and hydrophilic areas, and there is no <code class="docutils literal notranslate"><span class="pre">-f_index</span></code> option. The same effects can be obtained by defining suitable selections for <code class="docutils literal notranslate"><span class="pre">-output</span></code>. If you want output that contains the same numbers as with the old tool for a calculation group A and output group B, you can use <a class="reference external" href="https://manual.gromacs.org/current/user-guide/cmdline.html">[1]</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gmx</span> <span class="n">sasa</span> <span class="o">-</span><span class="n">surface</span> <span class="s1">&#39;group &quot;A&quot;&#39;</span> <span class="o">-</span><span class="n">output</span> <span class="s1">&#39;&quot;Hydrophobic&quot; group &quot;A&quot; and charge {-0.2 to 0.2}; &quot;Hydrophilic&quot; group &quot;B&quot; and not charge {-0.2 to 0.2}; &quot;Total&quot; group &quot;B&quot;&#39;</span>
</pre></div>
</div>
</div>
<p>Use Grace to plot the results:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xmgrace</span> <span class="o">-</span><span class="n">nxy</span> <span class="n">area</span><span class="o">.</span><span class="n">xvg</span>
</pre></div>
</div>
</section>
</section>
<section id="closed-circular-dna-in-explicit-solvent">
<span id="tutorial-4-g"></span><h2>4. Closed circular DNA in explicit solvent<a class="headerlink" href="#closed-circular-dna-in-explicit-solvent" title="Link to this heading"></a></h2>
<p>This tutorial shows how to use the SIRAH force field to perform a coarse grained (CG) simulation of a
closed circular DNA in explicit solvent (called WatFour, WT4). The main references for this tutorial are:<a class="reference external" href="https://pubs.acs.org/doi/abs/10.1021/ct900653p">Dans et al.</a> (latest parameters are those reported <a class="reference external" href="https://pubs.acs.org/doi/abs/10.1021/ct100379f">here</a>), and <a class="reference external" href="https://academic.oup.com/bioinformatics/article/32/10/1568/1743152">Machado &amp; Pantano</a>. We strongly advise you to read these articles before starting the tutorial.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Check the <a class="reference internal" href="#download-gromacs"><span class="std std-ref">Setting up SIRAH</span></a> section for download and set up details before starting this tutorial.
Since this is <strong>Tutorial 4</strong>, remember to replace <code class="docutils literal notranslate"><span class="pre">X.X</span></code>, the files corresponding to this tutorial can be found in: <code class="docutils literal notranslate"><span class="pre">sirah.ff/tutorial/4/</span></code></p>
</div>
<section id="id22">
<h3>4.1. Build CG representations<a class="headerlink" href="#id22" title="Link to this heading"></a></h3>
<p>Map the atomistic structure of the closed circular DNA to its CG representation:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./sirah.ff/tools/CGCONV/cgconv.pl<span class="w"> </span>-i<span class="w"> </span>sirah.ff/tutorial/4/ccdna.pdb<span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s/DCX A 1/CW5 A 1/&#39;</span><span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s/DCX B 1/CW5 B 1/&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>ccdna_cg.pdb
</pre></div>
</div>
<p>The input file <code class="docutils literal notranslate"><span class="pre">-i</span></code> ccdna.pdb contains all the heavy atoms composing the DNA molecule, while the output <code class="docutils literal notranslate"><span class="pre">-o</span></code> ccdna_cg.pdb preserves a few of them.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>5’ end residues mast be renamed to AW5, TW5, GW5 or CW5 to represent the corresponding Adenine, Thymine, Guanine or Cytosine extremes in a closed circular DNA.</p>
</div>
<p>Please check both PDB structures using VMD:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vmd<span class="w"> </span>-m<span class="w"> </span>./sirah.ff/tutorial/4/ccdna.pdb<span class="w"> </span>ccdna_cg.pdb
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This is the basic usage of the script <strong>cgconv.pl</strong>, you can learn other capabilities from its help by typing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./sirah.ff/tools/CGCONV/cgconv.pl<span class="w"> </span>-h
</pre></div>
</div>
</div>
<p>From now on it is just normal GROMACS stuff!</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>In GROMACS versions prior to 5.x, the “gmx” command should not be used.</p>
</div>
</section>
<section id="id23">
<h3>4.2. PDB to GROMACS format<a class="headerlink" href="#id23" title="Link to this heading"></a></h3>
<p>Use <code class="docutils literal notranslate"><span class="pre">pdb2gmx</span></code> to convert your PDB file into GROMACS format:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>pdb2gmx<span class="w"> </span>-f<span class="w"> </span>ccdna_cg.pdb<span class="w"> </span>-o<span class="w"> </span>ccdna_cg.gro
</pre></div>
</div>
<p>When prompted, choose <em>SIRAH force field</em> and then <em>SIRAH solvent models</em>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Warning messages about long, triangular or square bonds are fine and expected due to the CG topology of some residues.</p>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>However, missing atom messages are errors which probably trace back to the
mapping step. In that case, check your atomistic and mapped structures and do not carry on the
simulation until the problem is solved.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The distance cut-off to close the DNA molecule is read from <code class="docutils literal notranslate"><span class="pre">specbond.dat</span></code>. This parameter may need to be modified according to your system’s topology.</p>
</div>
</section>
<section id="id24">
<h3>4.3. Solvate the system<a class="headerlink" href="#id24" title="Link to this heading"></a></h3>
<p>Define the simulation box of the system</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>editconf<span class="w"> </span>-f<span class="w"> </span>ccdna_cg.gro<span class="w"> </span>-o<span class="w"> </span>ccdna_cg_box.gro<span class="w"> </span>-bt<span class="w"> </span>octahedron<span class="w"> </span>-d<span class="w"> </span><span class="m">2</span><span class="w"> </span>-c
</pre></div>
</div>
<p>Add WT4 molecules:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>solvate<span class="w"> </span>-cp<span class="w"> </span>ccdna_cg_box.gro<span class="w"> </span>-cs<span class="w"> </span>sirah.ff/wt416.gro<span class="w"> </span>-o<span class="w"> </span>ccdna_cg_sol.gro
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In GROMACS versions prior to 5.x, the command <em>gmx solvate</em> was called <em>genbox</em>.</p>
</div>
<p>Edit the [ molecules ] section in <code class="docutils literal notranslate"><span class="pre">topol.top</span></code> to include the number of added WT4 molecules:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Topology before editing</p></th>
<th class="head"><p>Topology after editing</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">[ molecules ]</div>
<div class="line">; Compound        #mols</div>
<div class="line">DNA_chain_A         1</div>
<div class="line">DNA_chain_B         1</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">[ molecules ]</div>
<div class="line">; Compound        #mols</div>
<div class="line">DNA_chain_A         1</div>
<div class="line">DNA_chain_B         1</div>
<div class="line">WT4             10240</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>If you forget to read the number of added WT4 molecules from the output of <em>solvate</em>, then use the following command line to get it</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">grep -c WP1 ccdna_cg_sol.gro</span>
</pre></div>
</div>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The number of added WT4 molecules, <strong>10240</strong>, may change according to the software version.</p>
</div>
<p>Add CG counterions and 0.15M NaCl:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>sirah.ff/tutorial/4/GPU/em_CGDNA.mdp<span class="w"> </span>-p<span class="w"> </span>topol.top<span class="w"> </span>-c<span class="w"> </span>ccdna_cg_sol.gro<span class="w"> </span>-o<span class="w"> </span>ccdna_cg_sol.tpr
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>genion<span class="w"> </span>-s<span class="w"> </span>ccdna_cg_sol.tpr<span class="w"> </span>-o<span class="w"> </span>ccdna_cg_ion.gro<span class="w"> </span>-np<span class="w"> </span><span class="m">401</span><span class="w"> </span>-pname<span class="w"> </span>NaW<span class="w"> </span>-nn<span class="w"> </span><span class="m">201</span><span class="w"> </span>-nname<span class="w"> </span>ClW
</pre></div>
</div>
<p>When prompted, choose to substitute <em>WT4</em> molecules by <em>ions</em>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The available electrolyte species in SIRAH force field are: <code class="docutils literal notranslate"><span class="pre">Na⁺</span></code> (NaW), <code class="docutils literal notranslate"><span class="pre">K⁺</span></code> (KW) and <code class="docutils literal notranslate"><span class="pre">Cl⁻</span></code> (ClW) which represent solvated ions in solution. One ion pair (e.g., NaW-ClW) each 34 WT4 molecules results in a salt concentration of ~0.15M (see <a class="reference internal" href="Tutorials%20amber.html#appendix"><span class="std std-ref">Appendix</span></a> for details). Counterions were added according to <a class="reference external" href="https://pubs.acs.org/doi/10.1021/acs.jctc.9b00953">Machado et al.</a>.</p>
</div>
<p>Edit the [ molecules ] section in <code class="docutils literal notranslate"><span class="pre">topol.top</span></code> to include the CG ions and the correct number of WT4.</p>
<p>Before running the simulation it may be a good idea to visualize your molecular system and check if the
DNA circle is closed. CG molecules are not recognized by molecular visualizers and will not display correctly. To fix this problem you may
generate a PSF file of the system using the script <code class="docutils literal notranslate"><span class="pre">g_top2psf.pl</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./sirah.ff/tools/g_top2psf.pl<span class="w"> </span>-i<span class="w"> </span>topol.top<span class="w"> </span>-o<span class="w"> </span>ccdna_cg_ion.psf
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is the basic usage of the script <code class="docutils literal notranslate"><span class="pre">g_top2psf.pl</span></code>, you can learn other capabilities from its help:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./sirah.ff/tools/g_top2psf.pl<span class="w"> </span>-h
</pre></div>
</div>
</div>
<p>Use VMD to check how the CG system looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vmd</span> <span class="n">ccdna_cg_ion</span><span class="o">.</span><span class="n">psf</span> <span class="n">ccdna_cg_ion</span><span class="o">.</span><span class="n">gro</span> <span class="o">-</span><span class="n">e</span> <span class="n">sirah</span><span class="o">.</span><span class="n">ff</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">sirah_vmdtk</span><span class="o">.</span><span class="n">tcl</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>VMD assigns default radius to unknown atom types, the script <code class="docutils literal notranslate"><span class="pre">sirah_vmdtk.tcl</span></code> sets the right ones, according to the CG representation. It also provides a kit of useful selection macros, coloring methods and backmapping utilities.
Use the command <code class="docutils literal notranslate"><span class="pre">sirah_help</span></code> in the Tcl/Tk console of VMD to access the manual pages. To learn about SIRAH Tools’ capabilities, you can also go to the <a class="reference internal" href="Tutorials%20sirahtools.html#sirah-tools"><span class="std std-ref">SIRAH Tools tutorial</span></a>.</p>
</div>
</section>
<section id="id26">
<h3>4.4. Run the simulation<a class="headerlink" href="#id26" title="Link to this heading"></a></h3>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>By default in this tutorial we will use input files for GROMACS on GPU (<code class="docutils literal notranslate"><span class="pre">sirah.ff/tutorial/4/GPU</span></code>). Example input files for using GROMACS on CPU can be found at: <code class="docutils literal notranslate"><span class="pre">sirah.ff/tutorial/4/CPU</span></code>.</p>
</div>
<p>The folder <code class="docutils literal notranslate"><span class="pre">sirah.ff/tutorial/4/GPU/</span></code> contains typical input files for energy minimization
(<code class="docutils literal notranslate"><span class="pre">em_CGDNA.mdp</span></code>), equilibration (<code class="docutils literal notranslate"><span class="pre">eq_CGDNA.mdp</span></code>) and production (<code class="docutils literal notranslate"><span class="pre">md_CGDNA.mdp</span></code>) runs. Please
check carefully the input flags therein.</p>
<p>Create an index file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;q&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>gmx<span class="w"> </span>make_ndx<span class="w"> </span>-f<span class="w"> </span>ccdna_cg_ion.gro<span class="w"> </span>-o<span class="w"> </span>ccdna_cg_ion.ndx
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>WT4 and CG ions (NaW and ClW) are automatically set to the group <em>SIRAH-Solvent</em>.</p>
</div>
<p>Make a new folder for the run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>run<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>run
</pre></div>
</div>
<p><strong>Energy Minimization</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>../sirah.ff/tutorial/4/GPU/em_CGDNA.mdp<span class="w"> </span>-p<span class="w"> </span>../topol.top<span class="w"> </span>-po<span class="w"> </span>em.mdp<span class="w"> </span>-n<span class="w"> </span>../ccdna_cg_ion.ndx<span class="w"> </span>-c<span class="w"> </span>../ccdna_cg_ion.gro<span class="w"> </span>-o<span class="w"> </span>ccdna_cg_em.tpr
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mdrun<span class="w"> </span>-deffnm<span class="w"> </span>ccdna_cg_em<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>EM.log<span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
<p><strong>Equilibration</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>../sirah.ff/tutorial/4/GPU/eq_CGDNA.mdp<span class="w"> </span>-p<span class="w"> </span>../topol.top<span class="w"> </span>-po<span class="w"> </span>eq.mdp<span class="w"> </span>-n<span class="w"> </span>../ccdna_cg_ion.ndx<span class="w"> </span>-c<span class="w"> </span>ccdna_cg_em.gro<span class="w"> </span>-o<span class="w"> </span>ccdna_cg_eq.tpr
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mdrun<span class="w"> </span>-deffnm<span class="w"> </span>ccdna_cg_eq<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>EQ.log<span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
<p><strong>Production (100ns)</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>../sirah.ff/tutorial/4/GPU/md_CGDNA.mdp<span class="w"> </span>-p<span class="w"> </span>../topol.top<span class="w"> </span>-po<span class="w"> </span>md.mdp<span class="w"> </span>-n<span class="w"> </span>../ccdna_cg_ion.ndx<span class="w"> </span>-c<span class="w"> </span>ccdna_cg_eq.gro<span class="w"> </span>-o<span class="w"> </span>ccdna_cg_md.tpr<span class="w"> </span>mdrun
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mdrun<span class="w"> </span>-deffnm<span class="w"> </span>ccdna_cg_md<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>MD.log<span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>GPU flags have been set for GROMACS 4.6.7; however, different versions may object to certain specifications.</p>
</div>
</section>
<section id="id27">
<h3>4.5. Visualizing the simulation<a class="headerlink" href="#id27" title="Link to this heading"></a></h3>
<p>That’s it! Now you can analyze the trajectory.</p>
<p>Process the output trajectory at folder <code class="docutils literal notranslate"><span class="pre">run/</span></code> to account for the Periodic Boundary Conditions (PBC):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>trjconv<span class="w"> </span>-s<span class="w"> </span>ccdna_cg_em.tpr<span class="w"> </span>-f<span class="w"> </span>ccdna_cg_md.xtc<span class="w"> </span>-o<span class="w"> </span>ccdna_cg_md_pbc.xtc<span class="w"> </span>-n<span class="w"> </span>../ccdna_cg_ion.ndx<span class="w"> </span>-ur<span class="w"> </span>compact<span class="w"> </span>-center<span class="w"> </span>-pbc<span class="w"> </span>mol
</pre></div>
</div>
<p>When prompted, choose <em>DNA</em> for centering and <em>System</em> for output.</p>
<p>Now you can check the simulation using VMD:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vmd<span class="w"> </span>../ccdna_cg_ion.psf<span class="w"> </span>../ccdna_cg_ion.gro<span class="w"> </span>ccdna_cg_md_pbc.xtc<span class="w"> </span>-e<span class="w"> </span>../sirah.ff/tools/sirah_vmdtk.tcl
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The file <code class="docutils literal notranslate"><span class="pre">sirah_vmdtk.tcl</span></code> is a Tcl script that is part of SIRAH Tools and contains the macros to properly visualize the coarse-grained structures in VMD. Use the command <code class="docutils literal notranslate"><span class="pre">sirah-help</span></code> in the Tcl/Tk console of VMD to access the manual pages. To learn about SIRAH Tools’ capabilities, you can also go to the <a class="reference internal" href="Tutorials%20sirahtools.html#sirah-tools"><span class="std std-ref">SIRAH Tools tutorial</span></a>.</p>
</div>
</section>
</section>
<section id="lipid-bilayers-in-explicit-solvent">
<span id="tutorial-5-g"></span><h2>5. Lipid bilayers in explicit solvent<a class="headerlink" href="#lipid-bilayers-in-explicit-solvent" title="Link to this heading"></a></h2>
<p>This tutorial shows how to use the SIRAH force field to perform a coarse grained (CG) simulation of a
DMPC bilayer in explicit solvent (called WatFour, WT4). The main references for
this tutorial are: <a class="reference external" href="https://doi.org/10.1021/acs.jctc.9b00435">Barrera et al.</a> and <a class="reference external" href="https://academic.oup.com/bioinformatics/article/32/10/1568/1743152">Machado &amp; Pantano</a>.
We strongly advise you to read these articles before starting the tutorial. You may also find interesting <a class="reference external" href="https://pubs.aip.org/books/monograph/137/chapter-abstract/58880922/Simulating-Transmembrane-Proteins-with-the-Coarse?redirectedFrom=fulltext">this book chapter</a>.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Check the <a class="reference internal" href="#download-gromacs"><span class="std std-ref">Setting up SIRAH</span></a> section for download and set up details before starting this tutorial.
Since this is <strong>Tutorial 5</strong>, remember to replace <code class="docutils literal notranslate"><span class="pre">X.X</span></code>, the files corresponding to this tutorial can be found in: <code class="docutils literal notranslate"><span class="pre">sirah.ff/tutorial/5/</span></code></p>
</div>
<section id="id29">
<h3>5.1. Build CG representations<a class="headerlink" href="#id29" title="Link to this heading"></a></h3>
<p>Map the atomistic structure of the preassembled DMPC bilayer to its CG representation:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./sirah.ff/tools/CGCONV/cgconv.pl<span class="w"> </span>-i<span class="w"> </span>sirah.ff/tutorial/5/DMPC64.pdb<span class="w"> </span>-o<span class="w"> </span>DMPC64_cg.pdb<span class="w"> </span>-a<span class="w"> </span>sirah.ff/tools/CGCONV/maps/tieleman_lipid.map
</pre></div>
</div>
<p>The input file <code class="docutils literal notranslate"><span class="pre">-i</span></code> DMPC64.pdb contains the atomistic representation of the DMPC bilayer, while the output <code class="docutils literal notranslate"><span class="pre">-o</span></code> DMPC64_cg.pdb is its SIRAH CG representation. The flag <code class="docutils literal notranslate"><span class="pre">-a</span></code> is a mapping scheme for lipids.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>By default, no mapping is applied to lipids, as there is no standard naming convention for them. So users are requested to append a MAP file from the list in <a class="reference internal" href="Tutorials%20amber.html#table"><span class="std std-ref">Table 1</span></a>, by setting the flag <code class="docutils literal notranslate"><span class="pre">-a</span></code> in <code class="docutils literal notranslate"><span class="pre">cgconv.pl</span></code>. We recommend using <a class="reference external" href="https://m3g.github.io/packmol/">PACKMOL</a> for building the system. Reference building-block structures are provided at folder <code class="docutils literal notranslate"><span class="pre">sirah.ff/PDB/</span></code>, which agree with the mapping scheme in <code class="docutils literal notranslate"><span class="pre">sirah.ff/tools/CGCONV/maps/tieleman_lipid.map</span></code>. The provided DMPC bilayer contains 64 lipid molecules per leaflet distributed in a 6.4 * 6.4 nm surface, taking into account an approximate area per lipid of 0.64 nm<sup>2</sup> at 333 K. The starting configuration was created with the input file <code class="docutils literal notranslate"><span class="pre">sirah.ff/tutorial/5/DMPC_bilayer.pkm</span></code>. See <a class="reference internal" href="FAQ.html"><span class="doc">FAQs</span></a> for cautions on mapping lipids to SIRAH and tips on using fragment-based topologies. If you do not find your issue please start a discussion in our <a class="reference external" href="https://github.com/SIRAHFF/documentation/discussions">github discussion page F&amp;Q</a>.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This an advanced usage of the script <strong>cgconv.pl</strong>, you can learn other capabilities from its help by typing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./sirah.ff/tools/CGCONV/cgconv.pl<span class="w"> </span>-h
</pre></div>
</div>
</div>
<p>The input file <code class="docutils literal notranslate"><span class="pre">DMPC64.pdb</span></code> contains all the heavy atoms composing the lipids, while the output <code class="docutils literal notranslate"><span class="pre">DMPC64_cg.pdb</span></code> preserves a few of them. Please check both PDB structures using VMD:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vmd<span class="w"> </span>-m<span class="w"> </span>sirah.ff/tutorial/5/DMPC64.pdb<span class="w"> </span>DMPC64_cg.pdb
</pre></div>
</div>
<p>From now on it is just normal GROMACS stuff!</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>In GROMACS versions prior to 5.x, the “gmx” command should not be used.</p>
</div>
</section>
<section id="id30">
<h3>5.2. PDB to GROMACS format<a class="headerlink" href="#id30" title="Link to this heading"></a></h3>
<p>Use <code class="docutils literal notranslate"><span class="pre">pdb2gmx</span></code> to convert your PDB file into GROMACS format:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>pdb2gmx<span class="w"> </span>-f<span class="w"> </span>DMPC64_cg.pdb<span class="w"> </span>-o<span class="w"> </span>DMPC64_cg.gro
</pre></div>
</div>
<p>When prompted, choose <em>SIRAH force field</em> and then <em>SIRAH solvent models</em>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Warning messages about long, triangular or square bonds are fine and expected due to the CG topology of some residues.</p>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>However, missing atom messages are errors which probably trace back to the
mapping step. In that case, check your atomistic and mapped structures and do not carry on the
simulation until the problem is solved.</p>
</div>
</section>
<section id="id31">
<h3>5.3. Solvate the system<a class="headerlink" href="#id31" title="Link to this heading"></a></h3>
<p>Define the simulation box of the system</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>editconf<span class="w"> </span>-f<span class="w"> </span>DMPC64_cg.gro<span class="w"> </span>-o<span class="w"> </span>DMPC64_cg_box.gro<span class="w"> </span>-box<span class="w"> </span><span class="m">6</span>.6<span class="w"> </span><span class="m">6</span>.6<span class="w"> </span><span class="m">10</span><span class="w"> </span>-c
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As PACKMOL does not consider periodicity while building up the system, increasing the box size a few Angstroms may be required to avoid bad contacts between images.</p>
</div>
<p>Add WT4 molecules:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>solvate<span class="w"> </span>-cp<span class="w"> </span>DMPC64_cg_box.gro<span class="w"> </span>-cs<span class="w"> </span>sirah.ff/wt416.gro<span class="w"> </span>-o<span class="w"> </span>DMPC64_cg_sol1.gro
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In GROMACS versions prior to 5.x, the command <em>gmx solvate</em> was called <em>genbox</em>.</p>
</div>
<p>Edit the [ molecules ] section in <code class="docutils literal notranslate"><span class="pre">topol.top</span></code> to include the number of added WT4 molecules:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Topology before editing</p></th>
<th class="head"><p>Topology after editing</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">[ molecules ]</div>
<div class="line">; Compound        #mols</div>
<div class="line">Lipid_chain_A           1</div>
<div class="line">Lipid_chain_B           1</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">[ molecules ]</div>
<div class="line">; Compound        #mols</div>
<div class="line">Lipid_chain_A           1</div>
<div class="line">Lipid_chain_B           1</div>
<div class="line">WT4                       850</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>If you forget to read the number of added WT4 molecules from the output of <em>solvate</em>, then use the following command line to get it</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">grep -c WP1 DMPC64_cg_sol1.gro</span>
</pre></div>
</div>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The number of added WT4 molecules, <strong>850</strong>, may change according to the software version.</p>
</div>
<p>Remove misplaced WT4 molecules inside the bilayer:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>sirah.ff/tutorial/5/CPU/em_CGLIP.mdp<span class="w"> </span>-p<span class="w"> </span>topol.top<span class="w"> </span>-c<span class="w"> </span>DMPC64_cg_sol1.gro<span class="w"> </span>-o<span class="w"> </span>DMPC64_cg_sol1.tpr
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;a BE* BC1* BC2* BCT*\n name 7 tail\n\nq&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>gmx<span class="w"> </span>make_ndx<span class="w"> </span>-f<span class="w"> </span>DMPC64_cg_sol1.gro<span class="w"> </span>-o<span class="w"> </span>DMPC64_cg_sol1.ndx
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span><span class="k">select</span><span class="w"> </span>-f<span class="w"> </span>DMPC64_cg_sol1.gro<span class="w"> </span>-s<span class="w"> </span>DMPC64_cg_sol1.tpr<span class="w"> </span>-n<span class="w"> </span>DMPC64_cg_sol1.ndx<span class="w"> </span>-on<span class="w"> </span>rm_close_wt4.ndx<span class="w"> </span>-select<span class="w"> </span><span class="s2">&quot;not (same residue as (resname WT4 and within 0.4 of group tail))&quot;</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>editconf<span class="w"> </span>-f<span class="w"> </span>DMPC64_cg_sol1.gro<span class="w"> </span>-o<span class="w"> </span>DMPC64_cg_sol2.gro<span class="w"> </span>-n<span class="w"> </span>rm_close_wt4.ndx
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Consult <code class="docutils literal notranslate"><span class="pre">sirah.ff/0ISSUES</span></code> and <a class="reference internal" href="FAQ.html"><span class="doc">FAQs</span></a> for information on known solvation issues.</p>
</div>
<p>Edit the [ molecules ] section in <code class="docutils literal notranslate"><span class="pre">topol.top</span></code> to correct the number of WT4 molecules:</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>If you forget to read the number of added WT4 molecules from the output of <em>solvate</em>, then use the following command line to get it</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">grep -c WP1 DMPC64_cg_sol2.gro</span>
</pre></div>
</div>
</div>
<p>Add CG counterions and 0.15M NaCl:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>sirah.ff/tutorial/5/GPU/em_CGLIP.mdp<span class="w"> </span>-p<span class="w"> </span>topol.top<span class="w"> </span>-c<span class="w"> </span>DMPC64_cg_sol2.gro<span class="w"> </span>-o<span class="w"> </span>DMPC64_cg_sol2.tpr
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>genion<span class="w"> </span>-s<span class="w"> </span>DMPC64_cg_sol2.tpr<span class="w"> </span>-o<span class="w"> </span>DMPC64_cg_ion.gro<span class="w"> </span>-np<span class="w"> </span><span class="m">21</span><span class="w"> </span>-pname<span class="w"> </span>NaW<span class="w"> </span>-nn<span class="w"> </span><span class="m">21</span><span class="w"> </span>-nname<span class="w"> </span>ClW
</pre></div>
</div>
<p>When prompted, choose to substitute <em>WT4</em> molecules by <em>ions</em>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The available electrolyte species in SIRAH force field are: <code class="docutils literal notranslate"><span class="pre">Na⁺</span></code> (NaW), <code class="docutils literal notranslate"><span class="pre">K⁺</span></code> (KW) and <code class="docutils literal notranslate"><span class="pre">Cl⁻</span></code> (ClW) which represent solvated ions in solution. One ion pair (e.g., NaW-ClW) each 34 WT4 molecules results in a salt concentration of ~0.15M (see <a class="reference internal" href="Tutorials%20amber.html#appendix"><span class="std std-ref">Appendix</span></a> for details). Counterions were added according to <a class="reference external" href="https://pubs.acs.org/doi/10.1021/acs.jctc.9b00953">Machado et al.</a>.</p>
</div>
<p>Edit the [ molecules ] section in <code class="docutils literal notranslate"><span class="pre">topol.top</span></code> to include the CG ions and the correct number of WT4.</p>
<p>Before running the simulation it may be a good idea to visualize your molecular system. CG molecules are not recognized by molecular visualizers and will not display correctly. To fix this problem you may
generate a PSF file of the system using the script <code class="docutils literal notranslate"><span class="pre">g_top2psf.pl</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./sirah.ff/tools/g_top2psf.pl<span class="w"> </span>-i<span class="w"> </span>topol.top<span class="w"> </span>-o<span class="w"> </span>DMPC64_cg_ion.psf
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is the basic usage of the script <code class="docutils literal notranslate"><span class="pre">g_top2psf.pl</span></code>, you can learn other capabilities from its help:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./sirah.ff/tools/g_top2psf.pl<span class="w"> </span>-h
</pre></div>
</div>
</div>
<p>Use VMD to check how the CG system looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vmd</span> <span class="n">DMPC64_cg_ion</span><span class="o">.</span><span class="n">psf</span> <span class="n">DMPC64_cg_ion</span><span class="o">.</span><span class="n">gro</span> <span class="o">-</span><span class="n">e</span> <span class="n">sirah</span><span class="o">.</span><span class="n">ff</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">sirah_vmdtk</span><span class="o">.</span><span class="n">tcl</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>VMD assigns default radius to unknown atom types, the script <code class="docutils literal notranslate"><span class="pre">sirah_vmdtk.tcl</span></code> sets the right ones, according to the CG representation. It also provides a kit of useful selection macros, coloring methods and backmapping utilities.
Use the command <code class="docutils literal notranslate"><span class="pre">sirah_help</span></code> in the Tcl/Tk console of VMD to access the manual pages. To learn about SIRAH Tools’ capabilities, you can also go to the <a class="reference internal" href="Tutorials%20sirahtools.html#sirah-tools"><span class="std std-ref">SIRAH Tools tutorial</span></a>.</p>
</div>
</section>
<section id="id33">
<h3>5.4. Run the simulation<a class="headerlink" href="#id33" title="Link to this heading"></a></h3>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>By default in this tutorial we will use input files for GROMACS on GPU (<code class="docutils literal notranslate"><span class="pre">sirah.ff/tutorial/5/GPU</span></code>). Example input files for using GROMACS on CPU can be found at: <code class="docutils literal notranslate"><span class="pre">sirah.ff/tutorial/5/CPU</span></code>.</p>
</div>
<p>The folder <code class="docutils literal notranslate"><span class="pre">sirah.ff/tutorial/5/GPU/</span></code> contains typical input files for energy minimization
(<code class="docutils literal notranslate"><span class="pre">em_CGLIP.mdp</span></code>), equilibration (<code class="docutils literal notranslate"><span class="pre">eq_CGLIP.mdp</span></code>) and production (<code class="docutils literal notranslate"><span class="pre">md_CGLIP.mdp</span></code>) runs. Please
check carefully the input flags therein.</p>
<p>Create an index file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;q&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>gmx<span class="w"> </span>make_ndx<span class="w"> </span>-f<span class="w"> </span>DMPC64_cg_ion.gro<span class="w"> </span>-o<span class="w"> </span>DMPC64_cg_ion.ndx
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>WT4 and CG ions (NaW, ClW) are automatically set to the group <em>SIRAH-Solvent</em> while DMPC (named CMM at CG level) is assigned to group <em>Lipid</em>.</p>
</div>
<p>Make a new folder for the run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>run<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>run
</pre></div>
</div>
<p><strong>Energy Minimization</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>../sirah.ff/tutorial/5/GPU/em_CGLIP.mdp<span class="w"> </span>-p<span class="w"> </span>../topol.top<span class="w"> </span>-po<span class="w"> </span>em.mdp<span class="w"> </span>-n<span class="w"> </span>../DMPC64_cg_ion.ndx<span class="w"> </span>-c<span class="w"> </span>../DMPC64_cg_ion.gro<span class="w"> </span>-o<span class="w"> </span>DMPC64_cg_em.tpr
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>mdrun<span class="w"> </span>-deffnm<span class="w"> </span>DMPC64_cg_em<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>EM.log<span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
<p><strong>Equilibration</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>../sirah.ff/tutorial/5/GPU/eq_CGLIP.mdp<span class="w"> </span>-p<span class="w"> </span>../topol.top<span class="w"> </span>-po<span class="w"> </span>eq.mdp<span class="w"> </span>-n<span class="w"> </span>../DMPC64_cg_ion.ndx<span class="w"> </span>-c<span class="w"> </span>DMPC64_cg_em.gro<span class="w"> </span>-o<span class="w"> </span>DMPC64_cg_eq.tpr
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>mdrun<span class="w"> </span>-deffnm<span class="w"> </span>DMPC_cg_eq<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>EQ.log<span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
<p><strong>Production (100ns)</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>../sirah.ff/tutorial/5/GPU/md_CGLIP.mdp<span class="w"> </span>-p<span class="w"> </span>../topol.top<span class="w"> </span>-po<span class="w"> </span>md.mdp<span class="w"> </span>-n<span class="w"> </span>../DMPC64_cg_ion.ndx<span class="w"> </span>-c<span class="w"> </span>DMPC64_cg_eq.gro<span class="w"> </span>-o<span class="w"> </span>DMPC64_cg_md.tpr
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>mdrun<span class="w"> </span>-deffnm<span class="w"> </span>DMPC64_cg_md<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>MD.log<span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>GPU flags have been set for GROMACS 4.6.7; however, different versions may object to certain specifications.</p>
</div>
</section>
<section id="id34">
<h3>5.5. Visualizing the simulation<a class="headerlink" href="#id34" title="Link to this heading"></a></h3>
<p>That’s it! Now you can analyze the trajectory.</p>
<p>Process the output trajectory at folder <code class="docutils literal notranslate"><span class="pre">run/</span></code> to account for the Periodic Boundary Conditions (PBC):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>trjconv<span class="w"> </span>-s<span class="w"> </span>DMPC64_cg_em.tpr<span class="w"> </span>-f<span class="w"> </span>DMPC64_cg_md.xtc<span class="w"> </span>-o<span class="w"> </span>DMPC64_cg_md_pbc.xtc<span class="w"> </span>-n<span class="w"> </span>../DMPC64_cg_ion.ndx<span class="w"> </span>-pbc<span class="w"> </span>mol
</pre></div>
</div>
<p>When prompted, choose <em>System</em> for output.</p>
<p>Now you can check the simulation using VMD:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vmd<span class="w"> </span>../DMPC64_cg_ion.psf<span class="w"> </span>../DMPC64_cg_ion.gro<span class="w"> </span>DMPC64_cg_md_pbc.xtc<span class="w"> </span>-e<span class="w"> </span>../sirah.ff/tools/sirah_vmdtk.tcl
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The file <code class="docutils literal notranslate"><span class="pre">sirah_vmdtk.tcl</span></code> is a Tcl script that is part of SIRAH Tools and contains the macros to properly visualize the coarse-grained structures in VMD. Use the command <code class="docutils literal notranslate"><span class="pre">sirah-help</span></code> in the Tcl/Tk console of VMD to access the manual pages. To learn about SIRAH Tools’ capabilities, you can also go to the <a class="reference internal" href="Tutorials%20sirahtools.html#sirah-tools"><span class="std std-ref">SIRAH Tools tutorial</span></a>.</p>
</div>
<p>Outside VMD, calculate the area per lipid:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>energy<span class="w"> </span>-f<span class="w"> </span>DMPC64_cg_md.edr<span class="w"> </span>-o<span class="w"> </span>box_XY.xvg
</pre></div>
</div>
<p>When prompted, choose <em>Box-X</em> and <em>Box-Y</em> for output. End your selection with zero.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To calculate the area per lipid, divide the membrane’s area by the DMPC molecules per leaflet:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[\frac{Area}{Lipid} = \frac{Box(x) * Box(y)}{64}\]</div>
</div></blockquote>
</div>
<p>To calculate density profiles and bilayer thickness, include a new group for phosphate beads in the index file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;a BFO\nq\n&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>gmx<span class="w"> </span>make_ndx<span class="w"> </span>-f<span class="w"> </span>DMPC64_cg_em.gro<span class="w"> </span>-n<span class="w"> </span>../DMPC64_cg_ion.ndx<span class="w"> </span>-o<span class="w"> </span>DMPC64_cg_ion.ndx
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>density<span class="w"> </span>-sl<span class="w"> </span><span class="m">1000</span><span class="w"> </span>-ng<span class="w"> </span><span class="m">5</span><span class="w"> </span>-f<span class="w"> </span>DMPC64_cg_md_pbc.xtc<span class="w"> </span>-s<span class="w"> </span>DMPC64_cg_em.tpr<span class="w"> </span>-n<span class="w"> </span>DMPC64_cg_ion.ndx<span class="w"> </span>-o<span class="w"> </span>density_profile.xvg
</pre></div>
</div>
<p>When prompted, choose <em>Lipid</em>, <em>WT4</em>, <em>NaW</em>, <em>ClW</em>, and <em>BFO</em>.</p>
<p>Use Grace to plot the results:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>xmgrace<span class="w"> </span>-nxy<span class="w"> </span>density_profile.xvg
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The thickness of the bilayer is the distance between the two peaks corresponding to the position of phosphate beads (BFO) along the z-axis.</p>
</div>
</section>
</section>
<section id="membrane-proteins-in-explicit-solvent">
<span id="tutorial-6-g"></span><h2>6. Membrane proteins in explicit solvent<a class="headerlink" href="#membrane-proteins-in-explicit-solvent" title="Link to this heading"></a></h2>
<p>This tutorial shows how to use the SIRAH force field to perform a coarse grained (CG) simulation of a protein embedded in a lipid bilayer using explicit solvent (called WatFour, WT4). The main references for
this tutorial are: <a class="reference external" href="https://doi.org/10.1021/acs.jctc.9b00006">Machado et al.</a>, <a class="reference external" href="https://doi.org/10.1021/acs.jctc.9b00435">Barrera et al.</a>, and <a class="reference external" href="https://academic.oup.com/bioinformatics/article/32/10/1568/1743152">Machado &amp; Pantano</a>.
We strongly advise you to read these articles before starting the tutorial.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We strongly advise you to read and complete <a class="reference internal" href="#tutorial-3-g"><span class="std std-ref">Tutorial 3</span></a> and <a class="reference internal" href="#tutorial-5-g"><span class="std std-ref">Tutorial 5</span></a> before starting.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Check the <a class="reference internal" href="#download-gromacs"><span class="std std-ref">Setting up SIRAH</span></a> section for download and set up details before starting this tutorial.
Since this is <strong>Tutorial 6</strong>, remember to replace <code class="docutils literal notranslate"><span class="pre">X.X</span></code>, the files corresponding to this tutorial can be found in: <code class="docutils literal notranslate"><span class="pre">sirah.ff/tutorial/6/</span></code></p>
</div>
<section id="id37">
<h3>6.1. Build CG representations<a class="headerlink" href="#id37" title="Link to this heading"></a></h3>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The mapping to CG requires the correct protonation state of each residue at a given pH. We recommend using the <a class="reference external" href="https://www.charmm-gui.org/">CHARMM-GUI server</a> and use the <strong>PDB Reader &amp; Manipulator</strong> to prepare your system. An account is required to access any of the CHARMM-GUI Input Generator modules, and it can take up to 24 hours to obtain one.</p>
<p>Other option is the <a class="reference external" href="https://server.poissonboltzmann.org/pdb2pqr">PDB2PQR server</a> and choosing the output naming scheme of AMBER for best compatibility. This server was utilized to generate the <em>PQR</em> file featured in this tutorial. Be aware that modified residues lacking parameters such as: MSE (seleno MET), TPO (phosphorylated THY), SEP (phosphorylated SER) or others are deleted from the PQR file by the server. In that case, mutate the residues to their unmodified form before submitting the structure to the server.</p>
<p>See <a class="reference internal" href="#tutorial-3-g"><span class="std std-ref">Tutorial 3</span></a> for cautions while preparing and mapping atomistic proteins to SIRAH.</p>
</div>
<p>Map the atomistic structure of protein <a class="reference external" href="https://www.rcsb.org/structure/2KYV">2KYV</a> to its CG representation:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./sirah.ff/tools/CGCONV/cgconv.pl<span class="w"> </span>-i<span class="w"> </span>sirah.ff/tutorial/6/2kyv.pqr<span class="w"> </span>-o<span class="w"> </span>2kyv_cg.pdb
</pre></div>
</div>
<p>The input file <code class="docutils literal notranslate"><span class="pre">-i</span></code> 2kyv.pqr contains the atomistic representation of <a class="reference external" href="https://www.rcsb.org/structure/2KYV">2KYV</a> structure at pH <strong>7.0</strong>, while the output <code class="docutils literal notranslate"><span class="pre">-o</span></code> 2kyv_cg.pdb is its SIRAH CG representation.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>If you already have an atomistic protein within a membrane, then you can simply map the entire system to SIRAH (this is highly recommended) and skip the step of embedding the protein into a lipid bilayer, however clipping the membrane patch may be required to set a correct solvation box (see bellow). By default no mapping is applied to lipids, as there is no standard naming convention for them. So users are requested to append a MAP file from the list in <a class="reference internal" href="Tutorials%20amber.html#table"><span class="std std-ref">Table 1</span></a>, by setting the flag <code class="docutils literal notranslate"><span class="pre">-a</span></code> in <code class="docutils literal notranslate"><span class="pre">cgconv.pl</span></code>. We recommend using <a class="reference external" href="https://m3g.github.io/packmol/">PACKMOL</a> for building the system. Reference building-block structures are provided at folder <code class="docutils literal notranslate"><span class="pre">sirah.ff/PDB/</span></code>, which agree with the mapping scheme <code class="docutils literal notranslate"><span class="pre">sirah.ff/tools/CGCONV/maps/tieleman_lipid.map</span></code>. See <a class="reference internal" href="FAQ.html"><span class="doc">FAQs</span></a> for cautions on mapping lipids to SIRAH and tips on using fragment-based topologies.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This an advanced usage of the script <strong>cgconv.pl</strong>, you can learn other capabilities from its help by typing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./sirah.ff/tools/CGCONV/cgconv.pl<span class="w"> </span>-h
</pre></div>
</div>
</div>
<section id="embed-the-protein-in-a-lipid-bilayer">
<h4>6.2. Embed the protein in a lipid bilayer<a class="headerlink" href="#embed-the-protein-in-a-lipid-bilayer" title="Link to this heading"></a></h4>
<p>We will show one possible way to do it by starting from a pre-equilibrated CG membrane patch.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">sirah_[version].ff/tutorial/6/</span></code> you will find a pre-stabilized CG DMPC bilayer patch, concatenate it with the previously generated CG representation of the phospholamban (PLN) pentamer (PDB code: <a class="reference external" href="https://www.rcsb.org/structure/2KYV">2KYV</a>):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>head<span class="w"> </span>-qn<span class="w"> </span>-1<span class="w"> </span>2kyv_cg.pdb<span class="w"> </span>./sirah.ff/tutorial/6/DMPC_cg.pdb<span class="w"> </span>&gt;<span class="w"> </span>2kyv_DMPC_cg_init.pdb
</pre></div>
</div>
<p>Luckily, we already oriented the protein inside the membrane. For setting up your own system you can go to <a class="reference external" href="https://opm.phar.umich.edu/">Orientations of Proteins in Membranes (OPM) database</a> and (if your structure is available) use the dummy atoms provided there to make them match with your membrane model (see <strong>Figure 1</strong>).</p>
<figure class="align-center" id="id45">
<a class="reference internal image-reference" href="_images/Tuto7.png"><img alt="_images/Tuto7.png" src="_images/Tuto7.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text"><strong>Figure 1.</strong> Protein oriented inside the membrane from the OPM database with dummy atoms represented as orange spheres.</span><a class="headerlink" href="#id45" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="delete-close-contact-lipid-molecules">
<h4>6.2.1. Delete close contact lipid molecules<a class="headerlink" href="#delete-close-contact-lipid-molecules" title="Link to this heading"></a></h4>
<p>We need to use VMD to to delete lipid molecules in close contact with the protein. For a proper treatment and visualization of the system in VMD you must first generate the molecular topology and initial coordinate files.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">pdb2gmx</span></code> to convert your PDB file into GROMACS format:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>pdb2gmx<span class="w"> </span>-f<span class="w"> </span>2kyv_DMPC_cg_init.pdb<span class="w"> </span>-o<span class="w"> </span>2kyv_DMPC_cg_init.gro<span class="w"> </span>-p<span class="w"> </span>init_topol<span class="w"> </span>-i<span class="w"> </span>init_posre
</pre></div>
</div>
<p>When prompted, choose <em>SIRAH force field</em> and then <em>SIRAH solvent models</em>.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>In GROMACS versions prior to 5.x, the “gmx” command should not be used.</p>
</div>
<p>CG molecules are not recognized by molecular visualizers and will not display correctly. To fix this problem you may
generate a PSF file of the system using the script <code class="docutils literal notranslate"><span class="pre">g_top2psf.pl</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./sirah.ff/tools/g_top2psf.pl<span class="w"> </span>-i<span class="w"> </span>init_topol.top<span class="w"> </span>-o<span class="w"> </span>2kyv_DMPC_cg_init.psf
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is the basic usage of the script <code class="docutils literal notranslate"><span class="pre">g_top2psf.pl</span></code>, you can learn other capabilities from its help:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./sirah.ff/tools/g_top2psf.pl<span class="w"> </span>-h
</pre></div>
</div>
</div>
<p>Use VMD to check how the CG system looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vmd</span> <span class="mi">2</span><span class="n">kyv_DMPC_cg_init</span><span class="o">.</span><span class="n">psf</span> <span class="mi">2</span><span class="n">kyv_DMPC_cg_init</span><span class="o">.</span><span class="n">gro</span> <span class="o">-</span><span class="n">e</span> <span class="n">sirah</span><span class="o">.</span><span class="n">ff</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">sirah_vmdtk</span><span class="o">.</span><span class="n">tcl</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>VMD assigns default radius to unknown atom types, the script <code class="docutils literal notranslate"><span class="pre">sirah_vmdtk.tcl</span></code> sets the right
ones, according to the CG representation. It also provides a kit of useful selection macros, coloring methods and backmapping utilities.
Use the command <code class="docutils literal notranslate"><span class="pre">sirah_help</span></code> in the Tcl/Tk console of VMD to access the manual pages. To learn about SIRAH Tools’ capabilities, you can also go to the <a class="reference internal" href="Tutorials%20sirahtools.html#sirah-tools"><span class="std std-ref">SIRAH Tools tutorial</span></a>.</p>
</div>
<p>In the VMD main window, select <em>Graphics</em> &gt; <em>Representations</em>. In the <em>Selected Atoms</em> box, type:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>not (same residue as (sirah_membrane within 3.5 of sirah_protein))
</pre></div>
</div>
<p>To save the refined protein-membrane system, in the VMD main window click on <code class="docutils literal notranslate"><span class="pre">2kyv_DMPC_cg_init.psf</span></code>, then select <em>File</em> &gt; <em>Save Coordinates</em>. In the <em>Selected atoms</em> option choose the selection you have just created and Save as <code class="docutils literal notranslate"><span class="pre">2kyv_DMPC_cg.pdb</span></code>.</p>
<p>From now on it is just normal GROMACS stuff!</p>
</section>
</section>
<section id="id40">
<h3>6.3. PDB to GROMACS format<a class="headerlink" href="#id40" title="Link to this heading"></a></h3>
<p>Use <code class="docutils literal notranslate"><span class="pre">pdb2gmx</span></code> to convert your PDB file into GROMACS format:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>pdb2gmx<span class="w"> </span>-f<span class="w"> </span>2kyv_DMPC_cg.pdb<span class="w"> </span>-o<span class="w"> </span>2kyv_DMPC_cg.gro
</pre></div>
</div>
<p>When prompted, choose <em>SIRAH force field</em> and then <em>SIRAH solvent models</em>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default charged terminal are used but it is possible to set them neutral with option <code class="docutils literal notranslate"><span class="pre">-ter</span></code></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Warning messages about long, triangular or square bonds are fine and expected due to the CG topology of some residues.</p>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>However, missing atom messages are errors which probably trace back to the
mapping step. In that case, check your atomistic and mapped structures and do not carry on the
simulation until the problem is solved.</p>
</div>
</section>
<section id="id41">
<h3>6.4. Solvate the system<a class="headerlink" href="#id41" title="Link to this heading"></a></h3>
<p>Define the simulation box of the system</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>editconf<span class="w"> </span>-f<span class="w"> </span>2kyv_DMPC_cg.gro<span class="w"> </span>-o<span class="w"> </span>2kyv_DMPC_cg_box.gro<span class="w"> </span>-box<span class="w"> </span><span class="m">12</span><span class="w"> </span><span class="m">12</span><span class="w"> </span><span class="m">12</span><span class="w"> </span>-c
</pre></div>
</div>
<p>Add WT4 molecules:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>solvate<span class="w"> </span>-cp<span class="w"> </span>2kyv_DMPC_cg_box.gro<span class="w"> </span>-cs<span class="w"> </span>sirah.ff/wt416.gro<span class="w"> </span>-o<span class="w"> </span>2kyv_DMPC_cg_solv1.gro
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Before GROMACS version 5.x, the command <em>gmx solvate</em> was called <em>genbox</em>.</p>
</div>
<p>Edit the [ molecules ] section in <code class="docutils literal notranslate"><span class="pre">topol.top</span></code> to include the number of added WT4 molecules:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Topology before editing</p></th>
<th class="head"><p>Topology after editing</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">[ molecules ]</div>
<div class="line">; Compound #mols</div>
<div class="line">Protein_chain_A    1</div>
<div class="line">Protein_chain_B    1</div>
<div class="line">Protein_chain_C    1</div>
<div class="line">Protein_chain_D    1</div>
<div class="line">Protein_chain_E    1</div>
<div class="line">Lipid_chain_F      1</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">[ molecules ]</div>
<div class="line">; Compound #mols</div>
<div class="line">Protein_chain_A    1</div>
<div class="line">Protein_chain_B    1</div>
<div class="line">Protein_chain_C    1</div>
<div class="line">Protein_chain_D    1</div>
<div class="line">Protein_chain_E    1</div>
<div class="line">Lipid_chain_F      1</div>
<div class="line">WT4             3875</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>If you forget to read the number of added WT4 molecules from the output of <em>solvate</em>, then use the following command line to get it</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">grep -c WP1 2kyv_DMPC_cg_solv1.gro</span>
</pre></div>
</div>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The number of added WT4 molecules, <strong>3875</strong>, may change according to the software version.</p>
</div>
<p>Remove misplaced WT4 molecules inside the bilayer:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>sirah.ff/tutorial/6/GPU/em1_CGLIPROT.mdp<span class="w"> </span>-p<span class="w"> </span>topol.top<span class="w"> </span>-c<span class="w"> </span>2kyv_DMPC_cg_solv1.gro<span class="w"> </span>-o<span class="w"> </span>2kyv_DMPC_cg_solv1.tpr
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;q&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>gmx<span class="w"> </span>make_ndx<span class="w"> </span>-f<span class="w"> </span>2kyv_DMPC_cg_solv1.gro<span class="w"> </span>-o<span class="w"> </span>2kyv_DMPC_cg_solv1.ndx
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span><span class="k">select</span><span class="w"> </span>-f<span class="w"> </span>2kyv_DMPC_cg_solv1.gro<span class="w"> </span>-s<span class="w"> </span>2kyv_DMPC_cg_solv1.tpr<span class="w"> </span>-n<span class="w"> </span>2kyv_DMPC_cg_solv1.ndx<span class="w"> </span>-on<span class="w"> </span>rm_close_wt4.ndx<span class="w"> </span>-sf<span class="w"> </span>sirah.ff/tutorial/6/rm_close_wt4.dat
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>editconf<span class="w"> </span>-f<span class="w"> </span>2kyv_DMPC_cg_solv1.gro<span class="w"> </span>-o<span class="w"> </span>2kyv_DMPC_cg_solv2.gro<span class="w"> </span>-n<span class="w"> </span>rm_close_wt4.ndx
</pre></div>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>New GROMACS versions may complain about the non-neutral charge of the system, aborting the generation of the TPR file by command grompp. We will neutralize the system later, so to overcame this issue, just allow a warning message by adding the following keyword to the grompp command line: <code class="docutils literal notranslate"><span class="pre">-maxwarn</span> <span class="pre">1</span></code></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Consult <code class="docutils literal notranslate"><span class="pre">sirah.ff/0ISSUES</span></code> and <a class="reference internal" href="FAQ.html"><span class="doc">FAQs</span></a> for information on known solvation issues.</p>
</div>
<p>Edit the [ molecules ] section in <code class="docutils literal notranslate"><span class="pre">topol.top</span></code> to correct the number of WT4 molecules:</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>If you forget to read the number of added WT4 molecules from the output of <em>solvate</em>, then use the following command line to get it</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">grep -c WP1 2kyv_DMPC_cg_solv2.gro</span>
</pre></div>
</div>
</div>
<p>Add CG counterions and 0.15M NaCl:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>sirah.ff/tutorial/6/GPU/em1_CGLIPROT.mdp<span class="w"> </span>-p<span class="w"> </span>topol.top<span class="w"> </span>-c<span class="w"> </span>2kyv_DMPC_cg_solv2.gro<span class="w"> </span>-o<span class="w"> </span>2kyv_DMPC_cg_solv2.tpr
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>genion<span class="w"> </span>-s<span class="w"> </span>2kyv_DMPC_cg_solv2.tpr<span class="w"> </span>-o<span class="w"> </span>2kyv_DMPC_cg_ion.gro<span class="w"> </span>-np<span class="w"> </span><span class="m">95</span><span class="w"> </span>-pname<span class="w"> </span>NaW<span class="w"> </span>-nn<span class="w"> </span><span class="m">110</span><span class="w"> </span>-nname<span class="w"> </span>ClW
</pre></div>
</div>
<p>When prompted, choose to substitute <em>WT4</em> molecules by <em>ions</em>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The available electrolyte species in SIRAH force field are: <code class="docutils literal notranslate"><span class="pre">Na⁺</span></code> (NaW), <code class="docutils literal notranslate"><span class="pre">K⁺</span></code> (KW) and <code class="docutils literal notranslate"><span class="pre">Cl⁻</span></code> (ClW) which represent solvated ions in solution. One ion pair (e.g., NaW-ClW) each 34 WT4 molecules results in a salt concentration of ~0.15M (see <a class="reference internal" href="Tutorials%20amber.html#appendix"><span class="std std-ref">Appendix</span></a> for details). Counterions were added according to <a class="reference external" href="https://pubs.acs.org/doi/10.1021/acs.jctc.9b00953">Machado et al.</a>.</p>
</div>
<p>Edit the [ molecules ] section in <code class="docutils literal notranslate"><span class="pre">topol.top</span></code> to include the CG ions and the correct number of WT4.</p>
<p>Before running the simulation it may be a good idea to visualize your molecular system. CG molecules are not recognized by molecular visualizers and will not display correctly. To fix this problem you may
generate a PSF file of the system using the script <code class="docutils literal notranslate"><span class="pre">g_top2psf.pl</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./sirah.ff/tools/g_top2psf.pl<span class="w"> </span>-i<span class="w"> </span>topol.top<span class="w"> </span>-o<span class="w"> </span>2kyv_DMPC_cg_ion.psf
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is the basic usage of the script <code class="docutils literal notranslate"><span class="pre">g_top2psf.pl</span></code>, you can learn other capabilities from its help:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./sirah.ff/tools/g_top2psf.pl<span class="w"> </span>-h
</pre></div>
</div>
</div>
<p>Use VMD to check how the CG system looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vmd</span> <span class="mi">2</span><span class="n">kyv_DMPC_cg_ion</span><span class="o">.</span><span class="n">psf</span> <span class="mi">2</span><span class="n">kyv_DMPC_cg_ion</span><span class="o">.</span><span class="n">gro</span> <span class="o">-</span><span class="n">e</span> <span class="n">sirah</span><span class="o">.</span><span class="n">ff</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">sirah_vmdtk</span><span class="o">.</span><span class="n">tcl</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>VMD assigns default radius to unknown atom types, the script <code class="docutils literal notranslate"><span class="pre">sirah_vmdtk.tcl</span></code> sets the right ones, according to the CG representation. It also provides a kit of useful selection macros, coloring methods and backmapping utilities.
Use the command <code class="docutils literal notranslate"><span class="pre">sirah_help</span></code> in the Tcl/Tk console of VMD to access the manual pages. To learn about SIRAH Tools’ capabilities, you can also go to the <a class="reference internal" href="Tutorials%20sirahtools.html#sirah-tools"><span class="std std-ref">SIRAH Tools tutorial</span></a>.</p>
</div>
</section>
<section id="generate-position-restraint-files">
<h3>6.5. Generate position restraint files<a class="headerlink" href="#generate-position-restraint-files" title="Link to this heading"></a></h3>
<p>To achive a proper interaction between the protein and bilayer, we will perform a equilibration step applying restraints over the protein backbone and lipids’ phosphate groups.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>GROMACS enumerates atoms starting from 1 in each topology file (e.i. <code class="docutils literal notranslate"><span class="pre">topol_*.itp</span></code>). In order to avoid atom index discordance between the .gro file of the system and each topology, we will need independent .gro files for the PLN monomer and the DMPC bilayer.</p>
</div>
<p>Crate an index file of the system with a group for PLN monomer, then generate the .gro file of it.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>WT4 and CG ions (NaW, ClW) are automatically set to the group <em>SIRAH-Solvent</em> while DMPC (named CMM at CG level) is assigned to group <em>Lipid</em>.</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;ri 1-52\nq&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>gmx<span class="w"> </span>make_ndx<span class="w"> </span>-f<span class="w"> </span>2kyv_DMPC_cg_ion.gro<span class="w"> </span>-o<span class="w"> </span>2kyv_DMPC_cg_ion.ndx
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>editconf<span class="w"> </span>-f<span class="w"> </span>2kyv_DMPC_cg_ion.gro<span class="w"> </span>-n<span class="w"> </span>2kyv_DMPC_cg_ion.ndx<span class="w"> </span>-o<span class="w"> </span>2kyv_DMPC_cg_monomer.gro
</pre></div>
</div>
<p>When prompted, choose <em>r_1-52</em>.</p>
<p>Create an index file for the monomer and add a group for the backbone <em>GO</em> and <em>GN</em> beads.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;a GO GN \nq&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>gmx<span class="w"> </span>make_ndx<span class="w"> </span>-f<span class="w"> </span>2kyv_DMPC_cg_monomer.gro<span class="w"> </span>-o<span class="w"> </span>2kyv_DMPC_cg_monomer.ndx
</pre></div>
</div>
<p>Create a position restraint file for the monomer backbone.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>genrestr<span class="w"> </span>-f<span class="w"> </span>2kyv_DMPC_cg_monomer.gro<span class="w"> </span>-n<span class="w"> </span>2kyv_DMPC_cg_monomer.ndx<span class="w"> </span>-fc<span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">100</span><span class="w"> </span>-o<span class="w"> </span>posre_BB.itp
</pre></div>
</div>
<p>When prompted, choose <em>GO_GN</em>.</p>
<p>Edit each <code class="docutils literal notranslate"><span class="pre">topol_Protein_chain_*.itp</span></code> (A to E) to include the new position restraints:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Topology before editing</p></th>
<th class="head"><p>Topology after editing</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">; Include Position restraint file</div>
<div class="line">#ifdef POSRES</div>
<div class="line">#include “posre_Protein.itp”</div>
<div class="line">#endif</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">; Include Position restraint file</div>
<div class="line">#ifdef POSRES</div>
<div class="line">#include “posre_Protein.itp”</div>
<div class="line">#endif</div>
<div class="line"><br /></div>
<div class="line">#ifdef POSREBB</div>
<div class="line">#include “posre_BB.itp”</div>
<div class="line">#endif</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Use a similar procedure to set the positional restraints on lipid’s phosphates.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>editconf<span class="w"> </span>-f<span class="w"> </span>2kyv_DMPC_cg_ion.gro<span class="w"> </span>-n<span class="w"> </span>2kyv_DMPC_cg_ion.ndx<span class="w"> </span>-o<span class="w"> </span>DMPC_cg.gro
</pre></div>
</div>
<p>When prompted, choose <em>Lipid</em>.</p>
<p>Create an index file of the membrane and add a group for phosphates (BFO beads).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;a BFO \nq&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>gmx<span class="w"> </span>make_ndx<span class="w"> </span>-f<span class="w"> </span>DMPC_cg.gro<span class="w"> </span>-o<span class="w"> </span>DMPC_cg.ndx
</pre></div>
</div>
<p>Create a position restraint file for phosphate groups in z coordinate.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>genrestr<span class="w"> </span>-f<span class="w"> </span>DMPC_cg.gro<span class="w"> </span>-n<span class="w"> </span>DMPC_cg.ndx<span class="w"> </span>-fc<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">100</span><span class="w"> </span>-o<span class="w"> </span>posre_Pz.itp
</pre></div>
</div>
<p>When prompted, choose <em>BFO</em>.</p>
<p>Edit <code class="docutils literal notranslate"><span class="pre">topol_Lipid_chain_F.itp</span></code> to include the new position restraints and define the flags <em>POSREZ</em> to switch on these restraints in the input file (.mdp).</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Topology before editing</p></th>
<th class="head"><p>Topology after editing</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">; Include Position restraint file</div>
<div class="line">#ifdef POSRES</div>
<div class="line">#include “posre_Lipid_chain_F.itp”</div>
<div class="line">#endif</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">; Include Position restraint file</div>
<div class="line">#ifdef POSRES</div>
<div class="line">#include “posre_Lipid_chain_F.itp”</div>
<div class="line">#endif</div>
<div class="line"><br /></div>
<div class="line">#ifdef POSREZ</div>
<div class="line">#include “posre_Pz.itp”</div>
<div class="line">#endif</div>
</div>
</td>
</tr>
</tbody>
</table>
</section>
<section id="id43">
<h3>6.6. Run the simulation<a class="headerlink" href="#id43" title="Link to this heading"></a></h3>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>By default in this tutorial we will use input files for GROMACS on GPU (<code class="docutils literal notranslate"><span class="pre">sirah.ff/tutorial/6/GPU</span></code>). Example input files for using GROMACS on CPU can be found at: <code class="docutils literal notranslate"><span class="pre">sirah.ff/tutorial/6/CPU</span></code>.</p>
</div>
<p>The folder <code class="docutils literal notranslate"><span class="pre">sirah.ff/tutorial/6/GPU/</span></code> contains typical input files for energy minimization
(<code class="docutils literal notranslate"><span class="pre">em_CGLIPROT.mdp</span></code>), equilibration (<code class="docutils literal notranslate"><span class="pre">eq_CGLIPROT.mdp</span></code>) and production (<code class="docutils literal notranslate"><span class="pre">md_CGLIPROT.mdp</span></code>) runs. Please
check carefully the input flags therein.</p>
<p>Make a new folder for the run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>run<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>run
</pre></div>
</div>
<p><strong>Energy Minimization of side chains by restraining the backbone</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>../sirah.ff/tutorial/6/GPU/em1_CGLIPROT.mdp<span class="w"> </span>-p<span class="w"> </span>../topol.top<span class="w"> </span>-n<span class="w"> </span>../2kyv_DMPC_cg_ion.ndx<span class="w"> </span>-c<span class="w"> </span>../2kyv_DMPC_cg_ion.gro<span class="w"> </span>-r<span class="w"> </span>../2kyv_DMPC_cg_ion.gro<span class="w"> </span>-o<span class="w"> </span>2kyv_DMPC_cg_em1.tpr
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>mdrun<span class="w"> </span>-deffnm<span class="w"> </span>2kyv_DMPC_cg_em1<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>EM1.log<span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
<p><strong>Energy Minimization of the whole system</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>../sirah.ff/tutorial/6/GPU/em2_CGLIPROT.mdp<span class="w"> </span>-p<span class="w"> </span>../topol.top<span class="w"> </span>-n<span class="w"> </span>../2kyv_DMPC_cg_ion.ndx<span class="w"> </span>-c<span class="w"> </span>2kyv_DMPC_cg_em1.gro<span class="w"> </span>-r<span class="w"> </span>2kyv_DMPC_cg_em1.gro<span class="w"> </span>-o<span class="w"> </span>2kyv_DMPC_cg_em2.tpr
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>mdrun<span class="w"> </span>-deffnm<span class="w"> </span>2kyv_DMPC_cg_em2<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>EM2.log<span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
<p><strong>Equilibration 1</strong>:</p>
<p>Position restraints are defined in <code class="docutils literal notranslate"><span class="pre">eq_CGLIPROT.mdp</span></code> file for protein backbone in xyz and phosphate groups (BFO beads) in z coordinate by setting keywords <code class="docutils literal notranslate"><span class="pre">-DPOSREBB</span></code> and <code class="docutils literal notranslate"><span class="pre">-DPOSREZ</span></code>, respectively.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>../sirah.ff/tutorial/6/GPU/eq1_CGLIPROT.mdp<span class="w"> </span>-p<span class="w"> </span>../topol.top<span class="w"> </span>-n<span class="w"> </span>../2kyv_DMPC_cg_ion.ndx<span class="w"> </span>-c<span class="w"> </span>2kyv_DMPC_cg_em2.gro<span class="w"> </span>-r<span class="w"> </span>2kyv_DMPC_cg_em2.gro<span class="w"> </span>-o<span class="w"> </span>2kyv_DMPC_cg_eq1.tpr
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>mdrun<span class="w"> </span>-deffnm<span class="w"> </span>2kyv_DMPC_cg_eq1<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>EQ1.log<span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
<p><strong>Equilibration 2</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>../sirah.ff/tutorial/6/GPU/eq2_CGLIPROT.mdp<span class="w"> </span>-p<span class="w"> </span>../topol.top<span class="w"> </span>-n<span class="w"> </span>../2kyv_DMPC_cg_ion.ndx<span class="w"> </span>-c<span class="w"> </span>2kyv_DMPC_cg_eq1.gro<span class="w"> </span>-r<span class="w"> </span>2kyv_DMPC_cg_eq1.gro<span class="w"> </span>-o<span class="w"> </span>2kyv_DMPC_cg_eq2.tpr
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>mdrun<span class="w"> </span>-deffnm<span class="w"> </span>2kyv_DMPC_cg_eq2<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>EQ2.log<span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
<p><strong>Production (1000ns)</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>../sirah.ff/tutorial/6/GPU/md_CGLIPROT.mdp<span class="w"> </span>-p<span class="w"> </span>../topol.top<span class="w"> </span>-n<span class="w"> </span>../2kyv_DMPC_cg_ion.ndx<span class="w"> </span>-c<span class="w"> </span>2kyv_DMPC_cg_eq2.gro<span class="w"> </span>-r<span class="w"> </span>2kyv_DMPC_cg_eq2.gro<span class="w"> </span>-o<span class="w"> </span>2kyv_DMPC_cg_md.tpr
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>mdrun<span class="w"> </span>-deffnm<span class="w"> </span>2kyv_DMPC_cg_md<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>MD.log<span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
</section>
<section id="id44">
<h3>6.7. Visualizing the simulation<a class="headerlink" href="#id44" title="Link to this heading"></a></h3>
<p>That’s it! Now you can analyze the trajectory.</p>
<p>Process the output trajectory at folder <code class="docutils literal notranslate"><span class="pre">run/</span></code> to account for the Periodic Boundary Conditions (PBC):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>trjconv<span class="w"> </span>-s<span class="w"> </span>2kyv_DMPC_cg_em1.tpr<span class="w"> </span>-f<span class="w"> </span>2kyv_DMPC_cg_md.xtc<span class="w"> </span>-o<span class="w"> </span>2kyv_DMPC_cg_md_pbc.xtc<span class="w"> </span>-n<span class="w"> </span>../2kyv_DMPC_cg_ion.ndx<span class="w"> </span>-pbc<span class="w"> </span>mol
</pre></div>
</div>
<p>When prompted, choose <em>System</em> for output.</p>
<p>Now you can check the simulation using VMD:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vmd<span class="w"> </span>../2kyv_DMPC_cg_ion.psf<span class="w"> </span>../2kyv_DMPC_cg_ion.gro<span class="w"> </span>2kyv_DMPC_cg_md_pbc.xtc<span class="w"> </span>-e<span class="w"> </span>../sirah.ff/tools/sirah_vmdtk.tcl
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The file <code class="docutils literal notranslate"><span class="pre">sirah_vmdtk.tcl</span></code> is a Tcl script that is part of SIRAH Tools and contains the macros to properly visualize the coarse-grained structures in VMD. Use the command <code class="docutils literal notranslate"><span class="pre">sirah-help</span></code> in the Tcl/Tk console of VMD to access the manual pages. To learn about SIRAH Tools’ capabilities, you can also go to the <a class="reference internal" href="Tutorials%20sirahtools.html#sirah-tools"><span class="std std-ref">SIRAH Tools tutorial</span></a>.</p>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Tutorials%20amber.html" class="btn btn-neutral float-left" title="AMBER" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Tutorials%20namd.html" class="btn btn-neutral float-right" title="NAMD" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, BA, SL, SM.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>